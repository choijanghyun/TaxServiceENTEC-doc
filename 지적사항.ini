1차 제미나이 지적사항
------------------------------
통합 경정청구 환급액 산출 시스템 개발상세설계서(v1.0)를 검토한 결과, 법인세 v4.0r1과 종합소득세 v1.3의 핵심 로직이 체계적으로 통합되어 있습니다. 특히 **세목 분기(TAX_TYPE) 아키텍처**를 통해 공통 모듈과 전용 모듈을 구분한 점이 탁월합니다.

다만, 국세청 심사 대응 및 환급액 극대화 관점에서 **데이터 정밀도와 법적 리스크 관리**를 위해 보완이 필요한 **5가지 핵심 사항**을 제안합니다.

---

## 1. 데이터 정밀도 및 계산 로직 보완

### [개인] 건강보험료 필요경비 vs 소득공제 분기 로직 (P4-01)

* **현황:** 설계서에는 가입 유형(지역/직장)에 따른 구분만 명시되어 있습니다.
* **보완:** 개인사업자 프롬프트 ㉖규칙에 따라 **'사업장 근로자용 사업주 부담분'**은 `TBL_INC_BUSINESS`에 입력되어 **필요경비(사업소득 차감)**로, **'대표자 본인 부담분'**은 `TBL_INC_DEDUCTION`에 입력되어 **소득공제(과세표준 차감)**로 처리되도록 인터페이스와 로직을 분리해야 합니다. 이는 성실신고 확인 및 과세표준 구간 확정에 직접적인 영향을 미칩니다.

### [법인] 업무용 승용차 세무조정 재검토 모듈 (M4-11 확장)

* **현황:** 법인세 프롬프트 [점검 0]의 '업무용 승용차 관련 비용 불산입 재검토' 내용이 모듈 설계에 구체화되지 않았습니다.
* **보완:** `M4-11` 서브모듈로 `M4-11a 업무용승용차 비용 재산산출`을 신설해야 합니다. 운행기록부 소급 확보 여부, 임직원 전용보험 가입 여부에 따른 **손금불산입액 환입 로직**이 필요합니다.

---

## 2. 세목별 특화 프로세스 누락 보완

### [개인] 성실신고확인대상자 판단 자동화 (P3-02 확장)

* **현황:** `TBL_INC_BASIC`에서 사용자의 입력을 수동으로 받게 되어 있습니다.
* **보완:** `P3-02` 모듈에서 `TBL_INC_BUSINESS`의 업종코드와 수입금액 합계를 `REF_INC_SINCERITY_THRESHOLD`와 대조하여 **성실신고확인대상 여부를 자동 판정**하는 로직을 추가해야 합니다. (판정 결과에 따라 6월 30일 경정청구 기한 적용 및 의료비·교육비 공제 활성화 결정)

### [법인] 결산확정의 원칙 검증 필터 (M3-00 강화)

* **현황:** 법인세 프롬프트의 '결산조정 vs 신고조정' 구분이 `M3-00`에 언급되어 있으나 구체적인 필터링 로직이 부족합니다.
* **보완:** 경정청구 신청 항목 중 **감가상각비, 대손충당금, 퇴직급여충당금** 등 결산조정 항목이 포함될 경우 국세청 거부 리스크를 `Validation (V)` 단계에서 차단하거나 **'결산서 변경 불가 안내'** 워닝(Warning)을 띄우는 로직을 명시해야 합니다.

---

## 3. 세목 간 상이한 공제·감면 처리 보완

### [공통] 통합고용세액공제 사후관리 추징액 산출 (M7-03)

* **현황:** 고용 유지 의무 위반 시 추징 리스크 안내가 보고서에만 명시되어 있습니다.
* **보완:** `M7-03` 모듈에 **'이자상당가산액'** 계산식을 추가해야 합니다. 개인사업자 프롬프트 ㉖번 규칙(인당 추징 예상액 수치화)에 따라, 경정청구 시점으로부터 2년 내 인원 감소 시 발생할 예상 추징액을 `(공제액 + 이자상당액)` 형태로 산출하는 로직이 필요합니다.

---

## 4. 신규 검증 규칙(Validation) 추가 제안

| 코드 | 유형 | 설명 | 근거 |
| --- | --- | --- | --- |
| **VP06** | **Validation** | [개인] 근로소득 합산 시 성실사업자 의료비·교육비 공제 가능 여부 재검증 | 소득세법 §122의3 |
| **BP05** | **Business** | [법인] 이월결손금 공제 한도(중소 100%, 일반 80%) 연도별 자동 적용 | 법인세법 §13 |
| **LP04** | **Legal** | [공통] 2025년 이후 창업 시 제6조 + 제29조의8 중복배제 강제 적용 | 2024.12.31 세법개정 |

---

## 5. 결론 및 향후 단계

보완된 설계서는 법령 개정 사항(2025년 이후 창업분 감면율 변동 및 중복배제 등)을 완벽히 수용하고 있습니다. 위 보완 사항을 반영하여 **v1.1**로 업데이트할 것을 권장합니다.

2차 제미나이 지적사항
------------------------------
제공해주신 **[법인세 프롬프트 v1.3]**, **[종합소득세 프롬프트 v1.3]**, 그리고 **[통합개발상세설계서 v1.0]**을 정밀 분석하여, 앞서 식별된 **6가지 핵심 보완 사항(데이터 정밀도, 특화 프로세스, 리스크 관리 등)**을 완벽하게 반영한 **v1.1** 버전을 작성했습니다.

---

# 통합 경정청구 환급액 산출 시스템 — 개발상세설계서 v1.1

> **문서 버전**: v1.1 (Final Integration)
> **기준 프롬프트**:
> 　- 법인사업자-법인세-경정청구-AI점검요청-프롬프트 v1.3
> 　- 개인사업자-종합소득세-경정청구-AI점검요청-프롬프트 v1.3
> **이전 버전**: 통합개발상세설계서 v1.0
> **작성일**: 2026-02-16
> **주요 변경사항**:
> 　1. **[개인]** 건강보험료(필요경비 vs 소득공제) 분기 로직 상세화
> 　2. **[법인]** 업무용 승용차 관련 손금불산입/추인 로직 추가
> 　3. **[개인]** 성실신고확인대상 자동 판정 로직 탑재
> 　4. **[법인]** 결산조정 항목(감가상각 등) 경정청구 차단 필터 강화
> 　5. **[공통]** 사후관리 위배 시 이자상당가산액 포함 추징액 산출 로직 추가
> 　6. **[검증]** 신규 Validation Rule (VP06, BP05, LP04) 추가

---

## 1. 주요 기능 및 로직 보완 내역 (v1.0 → v1.1)

### 1.1 [개인] 건강보험료 처리 정밀화 (P4-01 보완)

* **배경**: 개인사업자 프롬프트 ㉖번에 따라 직장가입자 본인의 보험료는 소득공제로, 근로자 부담분(사용자 부담분)은 필요경비로 처리해야 함.
* **변경**: `P4-01` 모듈 내 가입 유형별 분기 로직 명시화.

```text
[Logic Update: P4-01b]
IF deduction.health_type == 'LOCAL' THEN
    // 지역가입자: 전액 소득공제 (조특법 §122의3 성실사업자 의료비 등과는 별개)
    AddToIncomeDeduction(deduction.health_insurance)
ELSE IF deduction.health_type == 'EMPLOYED' THEN
    // 직장가입자(대표자): 본인 부담분 → 소득공제
    AddToIncomeDeduction(deduction.health_insurance_owner)
    // 직장가입자(직원): 사용자 부담분 → 필요경비 (이미 재무제표에 반영되었는지 확인)
    // ※ 경정청구 시 필요경비 누락분이 있다면 '소득금액 재계산'으로 연결
END IF

```

### 1.2 [법인] 업무용 승용차 관련 로직 추가 (M4-11a 신설)

* **배경**: 법인세 프롬프트 [점검 0]의 업무용 승용차 비용 불산입 재검토 요청 반영.
* **변경**: `M4-11` 하위에 서브모듈 추가.

```text
[New Module: M4-11a]
함수: recalculate_biz_car_expense(taxpayer_id)
입력: 운행기록부 유무, 임직원 전용보험 가입여부, 감가상각비, 처분손실
로직:
  1. 임직원 전용보험 미가입 → 전액 손금불산입 (사용자에게 '경정 불가' 안내)
  2. 운행기록부 미작성 → 연 1,500만원 한도 적용 (감가상각 800 + 유지비 700)
     IF 실제비용 > 1,500만원 THEN 초과분 손금불산입
  3. 감가상각비 한도 초과분(연 800만원) → 손금불산입 (유보)
  4. 처분손실 한도 초과분(연 800만원) → 손금불산입 (기타사외유출/유보)
  RETURN 조정된_세무조정_금액

```

### 1.3 [개인] 성실신고확인대상 자동 판정 (P3-02 보완)

* **배경**: 성실신고확인대상 여부에 따라 신고기한(6.30)과 의료비/교육비 공제 가능 여부가 달라짐.
* **변경**: 업종별 수입금액 기준(`REF_INC_SINCERITY_THRESHOLD`) 대조 로직 추가.

```text
[Logic Update: P3-02]
함수: check_sincerity_target(revenue_total, industry_code)
기준: REF_INC_SINCERITY_THRESHOLD (도소매 15억, 제조 7.5억, 서비스 5억 등)
로직:
  threshold = GET_THRESHOLD(industry_code)
  IF revenue_total >= threshold THEN
     Set is_sincerity_target = TRUE
     Set filing_deadline = 'YYYY-06-30'
     Enable Module P4-04 (의료비·교육비), P4-05 (확인비용)
  ELSE
     Set is_sincerity_target = FALSE
     Set filing_deadline = 'YYYY-05-31'
     Disable Module P4-04, P4-05
  END IF

```

---

## 2. 신규 및 수정된 기능 분할도 (v1.1)

```text
[Lv1] M3. 사전 점검 / 검증
│  ├─[Lv2] M3-00 경정청구 불가 사유 사전 검증 (기능 강화)
│  │  ├─[Lv3] [CORP] 결산조정 항목(감가상각, 퇴직급여) 변경 요청 시 차단 필터 ★ (New)
│  │  └─[Lv3] [INC] 추계신고 사업자 감면 배제 확인
│  │
│  ├─[Lv2] P3-02 종합소득세 기한 및 대상 판정 (기능 강화)
│  │  └─[Lv3] 성실신고확인대상 자동 판정 (수입금액 vs 업종별 기준) ★ (Update)

[Lv1] M4. 개별 공제·감면 산출
│  ├─── [CORP 전용]
│  ├─[Lv2] M4-11 세무조정 재검토
│  │  └─[Lv3] M4-11a 업무용 승용차 비용(운행기록부, 감가상각한도) 재계산 ★ (New)

[Lv1] M7. 사후관리 및 시뮬레이션
│  ├─[Lv2] M7-03 사후관리 리스크 분석 (기능 강화)
│  │  └─[Lv3] 고용 감소 시 '이자상당가산액' 포함 추징액 산출 로직 ★ (Update)

```

---

## 3. 검증 규칙 (Validation Rules) 추가 - v1.1

> 기존 v1.0 규칙에 아래 3가지 규칙을 추가하여 법적 리스크를 최소화합니다.

| 코드 | 유형 | 설명 | 근거 |
| --- | --- | --- | --- |
| **VP06** | **Validation** | **[개인]** 성실사업자 의료비·교육비(§122의3) 신청 시 `is_sincerity_target=TRUE`인지 검증. FALSE면 적용 불가 처리. | 조특법 §122의3 |
| **BP05** | **Business** | **[법인]** 이월결손금 공제 한도 적용 시, 중소기업이면 소득의 100%, 비중소기업이면 80%로 자동 제한 로직 적용. | 법인세법 §13 |
| **LP04** | **Legal** | **[공통]** 2025.1.1. 이후 창업한 경우, 창업감면(§6)과 통합고용공제(§29의8) 중복 적용 시도 시 **강제 에러(Hard Fail)** 처리 및 택일 유도. | 조특법 §127④ (2024 개정) |
| **LP05** | **Legal** | **[법인]** 경정청구 항목에 '감가상각비', '퇴직급여충당금' 등 결산조정 항목이 포함된 경우 경정청구 불가 항목으로 필터링. | 법인세법 §40 (결산확정주의) |

---

## 4. 계산 공식 업데이트 (추징액 상세)

### 4.1 F-COM-01: 고용세액공제 추징액 (이자상당액 포함)

기존 v1.0의 단순 추징액 계산을 보완하여 이자상당가산액을 포함합니다.

```text
Input:
  - reduced_count: 감소 인원 수
  - deduction_per_person: 당초 공제받은 인당 금액 (청년/일반)
  - days_elapsed: 공제받은 과세연도 종료일 다음날 ~ 납부일(추징사유 발생일)
  - interest_rate: 연 8.03% (또는 당해 연도 시행규칙 이율)

Formula:
  1. 본세 추징액 = reduced_count × deduction_per_person
  2. 이자상당가산액 = 본세 추징액 × (days_elapsed / 365) × interest_rate
  3. 총 납부할 세액 = 본세 추징액 + 이자상당가산액

```

---

## 5. 결론 및 승인 요청

본 **v1.1 설계서**는 사용자께서 지적해주신 데이터 정밀도 문제와 법인/개인 특화 프로세스의 누락분을 모두 반영하였습니다.

1. **정밀도**: 건강보험료의 성격별(비용 vs 공제) 분리, 성실신고 대상의 수치적 판정.
2. **리스크 관리**: 결산조정 항목의 경정청구 차단, 2025년 중복배제 룰 강제 적용.
3. **계산 정확성**: 사후관리 추징 시 이자상당액 반영.

이 설계서는 **법인세 프롬프트 v1.3**과 **종합소득세 프롬프트 v1.3**의 모든 법적 제약사항과 계산 로직을 충실히 이행할 수 있는 구조로 완성되었습니다.

3차 제미나이 지적사항
------------------------------
제시해주신 **법인세(v1.3)** 및 **종합소득세(v1.3)** 프롬프트와 **통합 설계서(v1.0)**를 바탕으로, 실무상 발생할 수 있는 누락 방지 로직과 리스크 관리 기능을 대폭 강화한 **[통합 경정청구 환급액 산출 시스템 개발상세설계서 v1.2]**를 작성하였습니다.

---

# 📋 통합 경정청구 환급액 산출 시스템 — 개발상세설계서 v1.2

> **문서 버전**: v1.2 (Final Refinement)
> **기준 데이터**:
> 　- 법인세 경정청구 프롬프트 v1.3
> 　- 종합소득세 경정청구 프롬프트 v1.3
> **설계 목표**: 세목별(TAX_TYPE) 과세 구조의 완벽한 분리 및 환급액 극대화 로직 구현

---

## 1. 세목 분기(Branching) 및 핵심 과세 체계

시스템은 `TAX_TYPE`(`CORP` / `INC`)에 따라 아래와 같이 연산 엔진을 분기합니다.

| 구분 | 법인세 (CORP) | 종합소득세 (INC) |
| --- | --- | --- |
| **과세 단위** | 법인 1개 단위 합산 | 대표자 1인 기준 인별 합산 |
| **세율 구조** | 9~24% (4단계 초과누진) | 6~45% (8단계 초과누진) |
| **최저한세 기준** | **과세표준**의 7% ~ 17% | **산출세액**의 35% / 45% |
| **소재지 판단** | 본점 소재지 간주 규정 적용 | 사업장별 개별 소재지 판단 |
| **공제 적용순서** | 법인세법 제59조 준수 | 소득세법 제60조 준수 |

---

## 2. 세목별 특화 모듈 상세 설계

### 2.1 [INC] 개인사업자 소득공제 및 세율구간 최적화 (P4-01)

개인사업자는 소득공제를 통해 과세표준 자체를 낮추는 것이 핵심입니다.

* **건강보험료 분리 처리**:
* **지역가입자 및 대표자 본인분**: `TBL_INC_DEDUCTION`에 삽입하여 **소득공제**로 처리합니다.
* **사업장 근로자용 사용자 부담분**: `TBL_INC_BUSINESS`의 **필요경비** 항목으로 분류하여 사업소득금액에서 직접 차감합니다.


* **세율구간 시뮬레이션**:
* 노란우산공제(최대 500만원) 등 누락된 소득공제 반영 후 변동된 과세표준에 따른 **세율 구간(6~45%) 변동 여부**를 체크합니다.



### 2.2 [CORP] 업무용 승용차 및 수입배당금 재검토 (M4-11)

법인세는 세무조정 사항에서 환급액이 결정되는 경우가 많습니다.

* **업무용 승용차(M4-11a)**:
* 운행기록부 사후 정비 여부를 확인하여, 기존에 부인된 비용(감가상각비 연 800만원 한도 등)의 **손금 산입 가능성**을 재산출합니다.


* **수입배당금 익금불산입(M4-09)**:
* 2023년 개정 규정(지분율 50% 이상 시 100% 익금불산입 등)과 종전 규정을 경정 대상 연도별로 매칭하여 재계산합니다.



### 2.3 [INC] 성실신고확인대상 자동 판정 (P3-02)

* 사업장별 `업종코드`와 `수입금액`을 `REF_INC_SINCERITY_THRESHOLD`와 대조하여 성실신고대상 여부를 **자동 판정**합니다.
* 판정 결과에 따라 6월 30일 신고기한 적용 및 **의료비·교육비 세액공제(§122의3)** 활성화를 결정합니다.

---

## 3. 공통 리스크 관리 및 추징 로직

### 3.1 사후관리 추징액 산출 (M7-03)

통합고용세액공제 등 적용 후 인원 감소 시 발생하는 추징액을 산출합니다.

* **PrincipleTax**: 감소 인원에 대해 기존에 공제받은 세액입니다.
* **InterestRate**: 국세기본법 시행규칙에 따른 이자상당가산액 이율을 적용합니다.

### 3.2 경정청구 차단 필터 (M3-00)

* **결산확정의 원칙**: 법인세의 경우 감가상각비, 대손충당금 등 **결산조정 항목**의 소급 변경 요청은 `Hard Fail`로 처리하여 국세청 거부 리스크를 원천 차단합니다.
* **추계신고 배제**: 개인사업자가 기장하지 않고 추계 신고한 경우, 대부분의 조특법상 공제·감면 적용이 불가함을 사전에 검증합니다.

---

## 4. 최종 환급 보고서 출력 양식 (M6-04)

보고서는 납세자가 한눈에 이해할 수 있도록 구조화합니다.

1. **환급 요약표**: 항목별 실질 환급액(농특세 20% 차감 후)을 제시합니다.
2. **최저한세 분석**:
* **법인**: 과세표준  7~17% 기준 분석.
* **개인**: 산출세액  35/45% 기준 분석.


3. **지방소득세 안내 (고정 양식)**:
> "종합소득세(또는 법인세) 환급액 **[금액]** + 지방소득세 환급액(10%) **[금액]** = 총 실질 수령액 **[금액]**"


4. **사후관리 경고**: 고용 유지 의무(2년) 위반 시 인당 예상 추징액을 수치화하여 명시합니다.

---

## 5. 향후 과제 및 승인 요청

본 설계서 v1.2는 두 세목의 프롬프트 제약 사항을 100% 수용하였으며, 특히 **세율 구간 최적화**와 **이자상당액 포함 추징 계산** 기능을 강화하였습니다.

* **승인 요청**: 본 설계 내용에 따라 백엔드 연산 엔진 및 프런트엔드 입력 폼 개발 착수를 승인해주시기 바랍니다.
* **다음 단계**: 2026년 최신 개정 세법 반영을 위한 `REF_*` 테이블 데이터 업데이트 및 테스트 시나리오 작성을 진행할 예정입니다.

---
