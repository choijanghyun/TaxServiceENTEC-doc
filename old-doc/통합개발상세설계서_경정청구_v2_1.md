# 통합개발상세설계서 v2.1 보완 — 점검결과 출력 테이블 및 외부 전달 인터페이스

> **보완 근거**: 경정청구_환급액_점검결과_출력양식_작성가이드.docx (초안)  
> **보완 대상**: 통합개발상세설계서_경정청구_v2.0 Final  
> **작성일**: 2026-02-16  
> **보완 성격**: 출력양식 가이드의 7개 섹션(A~G)과 v2.0 설계서의 출력 테이블·모듈·인터페이스 간 갭을 분석하고, 누락된 구조를 신설·보강

---

## 1. 갭 분석 총괄표

### 1.1 출력양식 가이드 ↔ v2.0 설계서 매핑

| 가이드 섹션 | 가이드 내용 | v2.0 대응 요소 | 갭 수준 | 보완 내용 |
|------------|------------|---------------|---------|----------|
| **A** 해당가능성 진단 | 납세자 기본정보 카드 + 자격진단 | TBL_CORP_BASIC, M3-02 | **신설 필요** | OUT_ELIGIBILITY_DIAGNOSIS 신설 |
| **B** 후보 항목 리스트 | 항목별 상세카드 (서류·일몰·배제) | OUT_INDIVIDUAL_CREDIT | **보강 필요** | 7개 컬럼 추가 (서류, 일몰, 조건, 배제항목 등) |
| **C** 최적조합·상호배제 | 그룹 A vs B 비교 + 배제 매트릭스 | OUT_COMBINATION | **보강 필요** | OUT_EXCLUSION_VERIFICATION 신설 |
| **D** 환급/추징 금액 | 기존 vs 경정 비교 + 환급가산금 | OUT_FINAL_REFUND | **소폭 보강** | agricultural surtax detail, 이월항목 배열 보강 |
| **E** 산출 진행 로그 | 25개 점검항목별 판정·근거 | LOG_CALCULATION | **신설 필요** | OUT_INSPECTION_LOG 신설 (대면용, 내부 로그와 분리) |
| **F** 주의·사후관리 | 의무사항 + 추가확인 필요 | OUT_RISK_ASSESSMENT | **보강 필요** | OUT_ADDITIONAL_CHECK 신설 |
| **G** JSON 제출 데이터 | 스키마·API 연동 | 없음 | **완전 신설** | JSON 스키마 정의 + REST API 인터페이스 설계 |

### 1.2 보완 통계

| 구분 | 건수 |
|------|------|
| 출력 테이블 신설 | 3개 (OUT_ELIGIBILITY_DIAGNOSIS, OUT_EXCLUSION_VERIFICATION, OUT_INSPECTION_LOG) |
| 출력 테이블 보강 | 3개 (OUT_INDIVIDUAL_CREDIT, OUT_FINAL_REFUND, OUT_RISK_ASSESSMENT) |
| 부속 테이블 신설 | 1개 (OUT_ADDITIONAL_CHECK) |
| 모듈 신설/보강 | 2개 (M6-05 JSON Export, M6-04 보고서 7섹션 재구조화) |
| JSON 스키마 정의 | 10개 객체 |
| REST API 엔드포인트 | 7개 |

---

## 2. 출력 테이블 신설 (3개)

### 2.1 OUT_ELIGIBILITY_DIAGNOSIS — 해당가능성 진단 결과 *(v2.1 신규, 가이드 섹션 A)*

> 납세자 기본 정보와 경정청구 자격을 하나의 스냅샷으로 저장. 보고서 섹션 A의 데이터 소스.

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 |
|----|--------|--------|-----------|------|
| 1 | diagnosis_id | 진단ID | INT | PK, AUTO_INCREMENT |
| 2 | entity_id | 납세자ID | VARCHAR(20) | FK (법인: corp_id / 개인: taxpayer_id) |
| 3 | tax_type | 세목구분 | VARCHAR(4) | CORP / INC |
| 4 | tax_year | 대상과세연도 | VARCHAR(4) | |
| 5 | business_type | 사업자유형 | VARCHAR(20) | 개인사업자 / 법인 |
| 6 | company_size | 기업규모 | VARCHAR(10) | 소기업 / 중기업 / 중견기업 / 대기업 |
| 7 | industry_ksic | 업종코드 | VARCHAR(10) | KSIC 세세분류 |
| 8 | industry_name | 업종명 | VARCHAR(100) | |
| 9 | location_city | 사업장소재지 | VARCHAR(100) | 시/군/구 |
| 10 | capital_zone | 수도권구분 | VARCHAR(20) | 과밀억제/성장관리/자연보전/비수도권 |
| 11 | revenue | 수입금액 | BIGINT | 원 단위 |
| 12 | tax_base | 과세표준 | BIGINT | 원 단위 |
| 13 | calculated_tax | 산출세액 | BIGINT | 원 단위 |
| 14 | filing_deadline | 법정신고기한 | DATE | CORP: 사업연도종료+3M, INC: 5.31/6.30 |
| 15 | claim_deadline | 경정청구기한 | DATE | filing_deadline + 5년 |
| 16 | deadline_eligible | 기한적격여부 | VARCHAR(10) | 적격 / 기한도과 |
| 17 | sme_eligible | 중소기업해당 | VARCHAR(10) | 해당 / 미해당 / 졸업유예 |
| 18 | sme_grace_end_year | 졸업유예종료연도 | VARCHAR(4) | 해당 시 |
| 19 | small_vs_medium | 소기업중기업구분 | VARCHAR(5) | 소기업 / 중기업 |
| 20 | venture_confirmed | 벤처기업확인 | BOOLEAN | |
| 21 | rd_department | 연구전담부서보유 | BOOLEAN | |
| 22 | sincerity_target | 성실신고확인대상 | BOOLEAN | INC 전용 (★v1.1 P3-02 자동판정) |
| 23 | bookkeeping_type | 기장유형 | VARCHAR(10) | INC 전용: 복식/간편/추계 |
| 24 | amendment_reason | 경정청구사유 | VARCHAR(200) | 미적용 공제 신규 / 방식변경 등 |
| 25 | overall_status | 종합판정 | VARCHAR(20) | eligible / ineligible / needs_review |
| 26 | diagnosis_detail | 진단상세 | TEXT | JSON: 세부 판정 근거 |

**설계 노트**:
- `entity_id`는 tax_type에 따라 TBL_CORP_BASIC.corp_id 또는 TBL_INC_BASIC.taxpayer_id를 참조
- `overall_status = 'ineligible'`이면 후속 모듈(M4~M7) 진행을 차단하는 Hard Fail 트리거
- 가이드 섹션 A-1(기본정보 카드)과 A-2(자격진단)를 단일 테이블로 통합

---

### 2.2 OUT_EXCLUSION_VERIFICATION — 상호배제 검증 결과 *(v2.1 신설, 가이드 섹션 C-2)*

> 선택된 조합이 조특법 §127④를 위반하지 않는지를 쌍(pair)별로 기록. 보고서 섹션 C 매트릭스의 데이터 소스.

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 |
|----|--------|--------|-----------|------|
| 1 | verify_id | 검증ID | INT | PK, AUTO_INCREMENT |
| 2 | entity_id | 납세자ID | VARCHAR(20) | FK |
| 3 | combo_id | 조합ID | INT | FK → OUT_COMBINATION |
| 4 | provision_a | 조항A | VARCHAR(20) | 예: 제7조 |
| 5 | provision_b | 조항B | VARCHAR(20) | 예: 제24조 |
| 6 | overlap_allowed | 중복허용여부 | VARCHAR(5) | O / X / COND |
| 7 | condition_note | 조건부사유 | VARCHAR(200) | COND인 경우: "2024년까지 가능, 2025년부터 불가" 등 |
| 8 | applied_year_rule | 연도별규칙적용 | VARCHAR(100) | 예: "§6+§29의8: 2024이전 중복가능" |
| 9 | violation_detected | 위반감지 | BOOLEAN | TRUE = 해당 조합에서 위반 발생 |
| 10 | legal_basis | 근거 | VARCHAR(100) | 조특법 §127④ |

**설계 노트**:
- 조합 내 N개 항목이면 N×(N-1)/2개의 쌍(pair) 레코드 생성
- `violation_detected = TRUE`인 행이 1개라도 있으면 해당 OUT_COMBINATION.is_valid = FALSE
- 가이드 C-2 매트릭스는 이 테이블에서 피벗(pivot)하여 렌더링

---

### 2.3 OUT_INSPECTION_LOG — 점검항목별 판정 결과 *(v2.1 신설, 가이드 섹션 E)*

> 기존 LOG_CALCULATION(내부 디버그 목적)과 분리하여, 납세자/세무대리인에게 제시할 점검 항목별 판정 요약을 저장.

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 |
|----|--------|--------|-----------|------|
| 1 | log_id | 로그ID | INT | PK, AUTO_INCREMENT |
| 2 | entity_id | 납세자ID | VARCHAR(20) | FK |
| 3 | tax_year | 과세연도 | VARCHAR(4) | |
| 4 | inspection_code | 점검코드 | VARCHAR(10) | 가이드 기준: 사전/1/2/.../25 |
| 5 | inspection_name | 점검항목명 | VARCHAR(100) | 예: "경정청구 기한", "그룹별 비교 분석" |
| 6 | legal_basis | 근거법령 | VARCHAR(100) | 예: "국기법 45조의2", "조특법 132조" |
| 7 | judgment | 판정결과 | VARCHAR(20) | 적격/완료/적용/해당없음/확인필요/위반없음/영향/무영향 |
| 8 | summary | 비고_산출근거 | VARCHAR(500) | 예: "5년 이내 확인", "그룹 A 선택" |
| 9 | related_module | 관련모듈 | VARCHAR(20) | 설계서 모듈 ID (M3-02, M5-02 등) |
| 10 | calculated_amount | 관련금액 | BIGINT | 해당 시 (환급가산금, 최저한세 조정액 등) |
| 11 | sort_order | 표시순서 | INT | 가이드 섹션 E 테이블 표시 순서 |

**설계 노트**:
- LOG_CALCULATION = 내부 감사추적(모든 함수 호출·입출력 JSON)
- OUT_INSPECTION_LOG = 외부 보고용(가이드 25개 점검항목 1:1 매핑)
- M6-04 보고서 생성 시 이 테이블을 조회하여 섹션 E 렌더링

---

## 3. 기존 출력 테이블 보강 (3개)

### 3.1 OUT_INDIVIDUAL_CREDIT — 7개 컬럼 추가 *(v2.1 보강, 가이드 섹션 B)*

> 가이드 섹션 B의 "후보 항목 상세 카드"에 필요한 정보를 OUT_INDIVIDUAL_CREDIT에 직접 보유하도록 보강.

**기존 12개 컬럼 유지 + 아래 7개 추가**:

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 | 가이드 매핑 |
|----|--------|--------|-----------|------|------------|
| 13 | item_status | 판정상태 | VARCHAR(15) | applicable / not_applicable / needs_review | B-1 판정 |
| 14 | conditions | 적용조건목록 | TEXT | JSON: ["중소기업 해당", "감면대상 업종"] | B-2 적용 조건 |
| 15 | required_documents | 필요서류목록 | TEXT | JSON: ["사업자등록증", "중소기업확인서", ...] | B-2 필요 서류 |
| 16 | sunset_date | 적용기한 | DATE | 예: 2028-12-31 | B-2 적용기한 |
| 17 | exclusion_items | 상호배제항목 | TEXT | JSON: ["ITEM-06", "ITEM-24"] — 중복불가 ID 목록 | B-2 유의사항 |
| 18 | deduction_rate | 감면율_공제율 | VARCHAR(100) | 예: "소기업 비수도권 30%" | B-2 감면율 |
| 19 | notes | 유의사항 | TEXT | 자유 텍스트: 이월불가 안내, 경과규정 등 | B-2 유의사항 |

**item_id 체계 (가이드 JSON candidate_items[].item_id와 통일)**:

| item_id | 항목 | provision |
|---------|------|-----------|
| ITEM-06 | 창업중소기업 세액감면 | 조특법 §6 |
| ITEM-07 | 중소기업 특별세액감면 | 조특법 §7 |
| ITEM-10 | 연구인력개발비 세액공제 | 조특법 §10 |
| ITEM-24 | 통합투자세액공제 | 조특법 §24 |
| ITEM-29-7 | 고용증대 세액공제(경과) | 조특법 §29의7 |
| ITEM-29-8 | 통합고용세액공제 | 조특법 §29의8 |
| ITEM-30-4 | 사회보험료 세액공제 | 조특법 §30의4 |
| ITEM-INC-122-3 | 성실사업자 의료비·교육비 | 조특법 §122의3 |
| ITEM-INC-56-2 | 기장세액공제 | 소득세법 §56의2 |
| ITEM-INC-57 | 외국납부세액공제 | 소득세법 §57 |
| ITEM-INC-LANDLORD | 착한 임대인 세액공제 | 조특법 §99의9 |

---

### 3.2 OUT_FINAL_REFUND — 5개 컬럼 추가 *(v2.1 보강, 가이드 섹션 D)*

> 가이드 섹션 D-1 환급액 산출 비교표 및 D-2 환급가산금에 대응하도록 보강.

**기존 17개 컬럼 유지 + 아래 5개 추가**:

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 | 가이드 매핑 |
|----|--------|--------|-----------|------|------------|
| 18 | new_min_tax_adj | 경정후최저한세조정액 | BIGINT | 최저한세 적용으로 인한 공제·감면 감액분 | D-1 최저한세 조정액 |
| 19 | nongteuk_tax_total | 농특세차감합계 | BIGINT | 전체 공제·감면에 대한 농특세 합계 | D-1 농특세 |
| 20 | penalty_tax | 가산세 | BIGINT | 무·과소신고 가산세 (경정 후 감소분 포함) | D-1 가산세 |
| 21 | carryover_items_detail | 이월공제상세배열 | TEXT | JSON: [{item_id, provision, amount, available_until}] | D-2 이월공제 대상 |
| 22 | refund_interest_end_date | 환급가산금종료일 | DATE | 환급결정일 | D-2 종료일 |

---

### 3.3 OUT_RISK_ASSESSMENT — 3개 컬럼 추가 + OUT_ADDITIONAL_CHECK 신설 *(v2.1, 가이드 섹션 F)*

#### OUT_RISK_ASSESSMENT 컬럼 추가

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 | 가이드 매핑 |
|----|--------|--------|-----------|------|------------|
| 11 | obligation_detail | 의무사항상세 | VARCHAR(200) | "2년간 고용 유지", "2년 내 자산 미처분" 등 | F-1 의무 사항 |
| 12 | violation_action | 위반시처리 | VARCHAR(200) | "공제세액 추징", "감면세액 추징" 등 | F-1 위반 시 처리 |
| 13 | interest_surcharge_formula | 이자상당가산액공식 | VARCHAR(200) | F-COM-01 참조 (★v1.1) | F-1 추징 상세 |

#### OUT_ADDITIONAL_CHECK — 추가확인 필요 항목 *(v2.1 신설, 가이드 F-2)*

| No | 컬럼명 | 한글명 | 데이터타입 | 설명 |
|----|--------|--------|-----------|------|
| 1 | check_id | 확인ID | INT | PK, AUTO_INCREMENT |
| 2 | entity_id | 납세자ID | VARCHAR(20) | FK |
| 3 | check_description | 확인필요사항 | VARCHAR(500) | 예: "R&D 전담부서 인력 변동 여부" |
| 4 | reason | 판단불가사유 | VARCHAR(300) | 예: "입력자료에 전담인력 명세 미포함" |
| 5 | related_inspection | 관련점검번호 | VARCHAR(10) | 가이드 점검코드 (22, 23 등) |
| 6 | related_module | 관련모듈 | VARCHAR(20) | M4-06 등 |
| 7 | priority | 우선순위 | VARCHAR(5) | 상/중/하 |
| 8 | status | 확인상태 | VARCHAR(15) | pending / confirmed / resolved |

---

## 4. M6 모듈 보강 — 보고서 7섹션 구조화 및 JSON Export

### 4.1 M6-04 최종 보고서 생성 — 기존 3종 → 가이드 7섹션 재구조화

**변경 전 (v2.0)**:
```
M6-04 최종 보고서 생성 (3종)
  ├ 보고서A: 경영진용 요약
  ├ 보고서B: 세무대리인용 상세
  └ 보고서C: 국세청 제출용
```

**변경 후 (v2.1)** — 기존 3종 유지 + 내부 섹션을 가이드 A~F에 정렬:
```
M6-04 최종 보고서 생성 (3종 × 7섹션 매트릭스)
  │
  ├ [공통 데이터 수집]
  │  ├ 섹션A 데이터: OUT_ELIGIBILITY_DIAGNOSIS 조회
  │  ├ 섹션B 데이터: OUT_INDIVIDUAL_CREDIT (item_status IN ('applicable','needs_review')) 조회
  │  ├ 섹션C 데이터: OUT_COMBINATION + OUT_EXCLUSION_VERIFICATION 조회
  │  ├ 섹션D 데이터: OUT_FINAL_REFUND 조회
  │  ├ 섹션E 데이터: OUT_INSPECTION_LOG 조회 (sort_order ASC)
  │  └ 섹션F 데이터: OUT_RISK_ASSESSMENT + OUT_ADDITIONAL_CHECK 조회
  │
  ├ 보고서A: 경영진용 요약 (1~2페이지)
  │  ├ 섹션A: 기본정보 카드 (요약) + 자격 판정 결과
  │  ├ 섹션C: 최적조합 요약 (그룹 A vs B 결론만)
  │  ├ 섹션D: 환급액 요약 (총수령예상액 강조)
  │  └ 섹션F: 핵심 리스크 1~2건 + 사후관리 기간
  │
  ├ 보고서B: 세무대리인용 상세 (전체)
  │  ├ 섹션A: 기본정보 카드 + 자격진단 상세
  │  ├ 섹션B: 후보 항목 상세 카드 (전 항목)
  │  ├ 섹션C: 그룹 비교표 + 상호배제 매트릭스
  │  ├ 섹션D: 환급액 비교표 + 환급가산금 + 이월공제 상세
  │  ├ 섹션E: 25개 점검 항목 전체 로그
  │  └ 섹션F: 사후관리 의무 + 추가확인 필요 전체 목록
  │
  └ 보고서C: 국세청 제출용
     ├ 섹션A: 납세자 정보 (경정청구서 양식)
     ├ 섹션D: 환급액 산출 내역 (기존 vs 경정)
     └ 첨부: 필요 증빙서류 목록 (섹션B required_documents 집계)
```

**보고서 유형별 섹션 포함 매트릭스**:

| 섹션 | 보고서A (경영진) | 보고서B (세무대리인) | 보고서C (국세청) |
|------|:---:|:---:|:---:|
| A. 해당가능성 진단 | ○ 요약 | ◉ 전체 | ○ 양식 |
| B. 후보 항목 리스트 | — | ◉ 전체 | — |
| C. 최적조합·배제검증 | ○ 결론 | ◉ 전체 | — |
| D. 환급/추징 금액 | ○ 요약 | ◉ 전체 | ◉ 전체 |
| E. 산출 진행 로그 | — | ◉ 전체 | — |
| F. 주의·사후관리 | ○ 핵심 | ◉ 전체 | — |
| G. JSON 데이터 | — | — | ◉ 첨부 |

---

### 4.2 M6-05 JSON Export 모듈 *(v2.1 신설, 가이드 섹션 G)*

```
[Lv2] M6-05 JSON Export (제출용 데이터 생성) ★v2.1
  ├─[Lv3] 6-1 report_meta 생성 (report_id, generated_at, prompt_version, tax_year, analysis_status)
  ├─[Lv3] 6-2 taxpayer_info 매핑 (OUT_ELIGIBILITY_DIAGNOSIS → JSON)
  ├─[Lv3] 6-3 eligibility 매핑 (OUT_ELIGIBILITY_DIAGNOSIS → JSON)
  ├─[Lv3] 6-4 candidate_items[] 매핑 (OUT_INDIVIDUAL_CREDIT → JSON 배열)
  ├─[Lv3] 6-5 optimal_combination 매핑 (OUT_COMBINATION rank=1 → JSON)
  ├─[Lv3] 6-6 exclusion_matrix 매핑 (OUT_EXCLUSION_VERIFICATION → pivot JSON)
  ├─[Lv3] 6-7 refund_calculation 매핑 (OUT_FINAL_REFUND → JSON)
  ├─[Lv3] 6-8 inspection_log[] 매핑 (OUT_INSPECTION_LOG → JSON 배열)
  ├─[Lv3] 6-9 post_management[] 매핑 (OUT_RISK_ASSESSMENT → JSON 배열)
  ├─[Lv3] 6-10 additional_checks[] 매핑 (OUT_ADDITIONAL_CHECK → JSON 배열)
  └─[Lv3] 6-11 JSON 스키마 검증 (필수 필드 누락 체크) + 직렬화
```

---

## 5. JSON 스키마 정의 (가이드 섹션 G 구체화)

### 5.1 최상위 구조

```json
{
  "report_meta": { ... },
  "taxpayer_info": { ... },
  "eligibility": { ... },
  "candidate_items": [ ... ],
  "optimal_combination": { ... },
  "exclusion_matrix": { ... },
  "refund_calculation": { ... },
  "inspection_log": [ ... ],
  "post_management": [ ... ],
  "additional_checks": [ ... ]
}
```

### 5.2 객체별 상세 — 가이드 보완 + 설계서 정합

#### (1) report_meta

| 필드 | 타입 | 필수 | 설명 | 소스 테이블 |
|------|------|:---:|------|------------|
| report_id | string | ✓ | RPT-{YYYY}-{SEQ} | 시스템 생성 |
| generated_at | string | ✓ | ISO 8601 (KST) | 시스템 시각 |
| prompt_version | string | ✓ | 프롬프트 버전 | REF_SYSTEM_PARAM |
| design_version | string | ✓ | 설계서 버전 (예: "v2.1") | REF_SYSTEM_PARAM |
| tax_year | string | ✓ | 대상 과세연도 | OUT_ELIGIBILITY_DIAGNOSIS |
| tax_type | string | ✓ | CORP / INC | OUT_ELIGIBILITY_DIAGNOSIS |
| analysis_status | string | ✓ | completed / partial / needs_review | 전체 판정 집계 |

#### (2) taxpayer_info — 가이드 대비 보강 포인트

가이드 초안에 **법인 전용 필드가 부족**. 설계서 기반으로 아래 추가:

| 추가 필드 | 타입 | 조건 | 설명 | 소스 |
|----------|------|------|------|------|
| tax_type | string | 필수 | CORP / INC | — |
| corp_id | string | CORP | 법인등록번호 | TBL_CORP_BASIC |
| biz_income | number | CORP | 각사업연도소득 | TBL_CORP_BASIC |
| non_taxable_income | number | CORP | 비과세소득 | TBL_CORP_BASIC |
| loss_carryforward_balance | number | CORP | 이월결손금잔액 | TBL_LOSS_CARRYFORWARD 합계 |
| consolidated_filing | boolean | CORP | 연결납세여부 | TBL_CORP_BASIC |
| sincerity_target | boolean | INC | 성실신고확인대상 | TBL_INC_BASIC (★v1.1) |
| bookkeeping_type | string | INC | 기장유형 | TBL_INC_BASIC |
| joint_venture_ratio | number | INC | 공동사업지분율 | TBL_INC_BUSINESS |
| multi_business_count | number | INC | 사업장수 | TBL_INC_BUSINESS 카운트 |

#### (3) eligibility

| 필드 | 타입 | 필수 | 설명 |
|------|------|:---:|------|
| deadline_check | object | ✓ | {eligible: bool, filing_deadline: string, claim_deadline: string, basis: "국기법 §45의2①"} |
| sme_check | object | ✓ | {eligible: string, size: string, grace_end: string?, basis: "조특법시행령 §2"} |
| capital_zone_check | object | ✓ | {zone: string, basis: "수도권정비계획법 §2"} |
| settlement_check | object | CORP | {result: "pass"/"fail", blocked_items: string[], basis: "법인세법 §40"} — ★v1.1 M3-00 |
| estimate_check | object | INC | {is_estimate: bool, blocked_items: string[], basis: "조특법 §128"} |
| sincerity_check | object | INC | {is_target: bool, threshold: string, filing_deadline: string} — ★v1.1 P3-02 |
| overall_status | string | ✓ | eligible / ineligible / needs_review |

#### (4) candidate_items[] — 가이드 대비 보강 포인트

가이드 초안은 공통 항목만 나열. 설계서 기반으로 **세목별 분기 필드** 추가:

| 추가 필드 | 타입 | 조건 | 설명 |
|----------|------|------|------|
| tax_type_scope | string | 필수 | COMMON / CORP / INC — 해당 항목의 세목 적용 범위 |
| min_tax_subject | boolean | 필수 | 최저한세 대상 여부 |
| min_tax_exempt_detail | object | 해당시 | R&D 배제 상세 {national_exempt, growth_exempt, general_exempt} |
| income_allocation_ratio | number | INC | 감면소득비율 (다사업장 배분 시) |
| settlement_adjustment | boolean | CORP | 결산조정 해당 여부 (★v1.1 M3-00) |

#### (5) optimal_combination

| 필드 | 타입 | 필수 | 설명 | 소스 |
|------|------|:---:|------|------|
| selected_group | string | ✓ | A / B | OUT_COMBINATION (rank=1) |
| group_a | object | ✓ | {items[], exemption_total, credit_total, nongteuk, min_tax_adj, net_refund} | |
| group_b | object | ✓ | (동일 구조) | |
| difference | number | ✓ | group_a.net_refund - group_b.net_refund | |
| selection_reason | string | ✓ | "그룹 A가 N원 유리" | |
| application_order | string[] | ✓ | ["감면(§7)", "이월불가(§29의8)", "이월가능(§10)"] — ★v2.0 적용순서 | |

#### (6) exclusion_matrix

| 필드 | 타입 | 필수 | 설명 |
|------|------|:---:|------|
| matrix | object[][] | ✓ | 2D 매트릭스: {provision_a, provision_b, allowed: "O"/"X"/"COND", condition} |
| all_valid | boolean | ✓ | 전체 위반 없음 여부 |
| violations | object[] | — | 위반 시: [{provision_a, provision_b, reason}] |

#### (7) refund_calculation — 가이드 대비 보강 포인트

가이드 초안에 **법인 중간예납 분리·농특세 상세 부재**. v2.0 설계 기반 추가:

| 추가 필드 | 타입 | 조건 | 설명 |
|----------|------|------|------|
| original.paid_interim | number | CORP | 기존 중간예납 납부액 |
| amended.nongteuk_total | number | 필수 | 경정 후 농특세 합계 |
| amended.nongteuk_detail | object[] | 필수 | [{provision, exempt: bool, amount}] — 항목별 농특세 |
| interim_refund | object | CORP | {amount, interest_start, interest_amount} — ★v2.0 분리기산 |
| local_tax | object | 필수 | {amount, basis: "국세 × 10%", separate_claim_required: true} |
| surtax_refund | number | CORP | 농특세 환급분 (비과세→과세 전환 시) |

#### (8) inspection_log[]

| 필드 | 타입 | 필수 | 설명 |
|------|------|:---:|------|
| code | string | ✓ | 점검코드 ("사전", "1", ..., "25") |
| name | string | ✓ | 점검항목명 |
| legal_basis | string | ✓ | 근거법령 |
| judgment | string | ✓ | 판정결과 |
| summary | string | ✓ | 산출근거 요약 |
| amount | number | — | 관련금액 (해당 시) |

#### (9) post_management[]

| 필드 | 타입 | 필수 | 설명 |
|------|------|:---:|------|
| provision | string | ✓ | 관련조항 |
| obligation | string | ✓ | 의무사항 |
| period_start | string | ✓ | 의무기간 시작 |
| period_end | string | ✓ | 의무기간 종료 |
| violation_action | string | ✓ | 위반시 처리 |
| potential_clawback | number | ✓ | 추징예상액 |
| interest_surcharge | number | ✓ | 이자상당가산액 (★v1.1 F-COM-01) |
| risk_level | string | ✓ | 상/중/하 |

#### (10) additional_checks[]

| 필드 | 타입 | 필수 | 설명 |
|------|------|:---:|------|
| check_id | number | ✓ | 순번 |
| description | string | ✓ | 확인 필요 사항 |
| reason | string | ✓ | 판단 불가 사유 |
| related_inspection | string | ✓ | 관련 점검코드 |
| priority | string | ✓ | 상/중/하 |

---

## 6. REST API 인터페이스 설계 *(v2.1 신설)*

> v2.0 I15 "API 인터페이스 설계 추가"의 구체화. 가이드 섹션 G "시스템 연동"을 위한 엔드포인트 정의.

### 6.1 API 기본 사항

| 항목 | 내용 |
|------|------|
| 프로토콜 | HTTPS (TLS 1.2+) |
| 인증 | API Key (헤더: `X-API-Key`) + 사업자번호 기반 접근 제어 |
| 형식 | JSON (Content-Type: application/json; charset=utf-8) |
| 버전 관리 | URL 경로: `/api/v1/...` |
| 에러 응답 | `{error_code, message, detail}` |
| 금액 단위 | 원 (정수, BIGINT) |
| 날짜 형식 | ISO 8601 (YYYY-MM-DD / YYYY-MM-DDTHH:MM:SS+09:00) |

### 6.2 엔드포인트 목록

| No | Method | Path | 설명 | 요청 | 응답 |
|----|--------|------|------|------|------|
| API-01 | POST | `/api/v1/analysis/run` | 점검 실행 (전체 파이프라인) | 입력 JSON (전 테이블 데이터) | {report_id, status} |
| API-02 | GET | `/api/v1/reports/{report_id}` | 전체 보고서 JSON 조회 | — | 가이드 섹션 G 전체 JSON |
| API-03 | GET | `/api/v1/reports/{report_id}/sections/{A-G}` | 섹션별 조회 | — | 해당 섹션 JSON |
| API-04 | GET | `/api/v1/reports/{report_id}/pdf/{type}` | PDF 보고서 다운로드 | type=summary/detail/submission | PDF binary |
| API-05 | GET | `/api/v1/reports/{report_id}/checklist` | 체크리스트 (부록) | — | 15개 확인항목 JSON |
| API-06 | POST | `/api/v1/simulation/multi-year` | 다수 과세연도 시뮬레이션 | 연도 배열 + 입력 데이터 | 연도별 report_id 배열 |
| API-07 | GET | `/api/v1/reference/exclusion-matrix` | 상호배제 매트릭스 기준정보 | — | REF_MUTUAL_EXCLUSION JSON |

### 6.3 API-02 응답 예시 (축약)

```json
{
  "report_meta": {
    "report_id": "RPT-2026-001",
    "generated_at": "2026-02-16T14:30:00+09:00",
    "prompt_version": "v1.3",
    "design_version": "v2.1",
    "tax_year": "2024",
    "tax_type": "CORP",
    "analysis_status": "completed"
  },
  "taxpayer_info": {
    "business_type": "법인",
    "company_size": "소기업",
    "industry_code": "62010",
    "industry_name": "컴퓨터 프로그래밍 서비스업",
    "location": {"city": "성남시 분당구", "capital_zone": "과밀억제"},
    "revenue": 1500000000,
    "calculated_tax": 45000000,
    "tax_base": 280000000,
    "employees": {"prev_total": 12.00, "prev_youth": 3.00, "curr_total": 15.00, "curr_youth": 5.00},
    "venture_confirmed": true,
    "rd_department": true,
    "loss_carryforward_balance": 0
  },
  "eligibility": {
    "deadline_check": {"eligible": true, "filing_deadline": "2025-03-31", "claim_deadline": "2030-03-31"},
    "sme_check": {"eligible": "해당", "size": "소기업", "grace_end": null},
    "capital_zone_check": {"zone": "과밀억제"},
    "settlement_check": {"result": "pass", "blocked_items": []},
    "overall_status": "eligible"
  },
  "candidate_items": [
    {
      "item_id": "ITEM-07",
      "name": "중소기업 특별세액감면",
      "legal_basis": "조특법 제7조",
      "type": "세액감면",
      "status": "applicable",
      "estimated_amount": 8500000,
      "nongteukse": {"exempt": true, "amount": 0},
      "net_amount": 8500000,
      "min_tax_subject": true,
      "sunset_date": "2028-12-31",
      "carryover": {"possible": false},
      "exclusions": ["ITEM-06", "ITEM-24"],
      "conditions": ["중소기업 해당", "감면대상 업종", "수입금액 기준 소기업"],
      "required_documents": ["사업자등록증", "중소기업확인서", "업종별 감면세액 계산서"],
      "deduction_rate": "소기업 수도권 20%",
      "notes": "이월 불가 — 해당 연도 미사용분 소멸"
    }
  ],
  "optimal_combination": {
    "selected_group": "A",
    "group_a": {
      "items": ["ITEM-07", "ITEM-29-8", "ITEM-10"],
      "exemption_total": 8500000,
      "credit_total": 15800000,
      "nongteuk": 3160000,
      "min_tax_adj": 0,
      "net_refund": 21140000
    },
    "group_b": {
      "items": ["ITEM-24", "ITEM-29-8", "ITEM-10"],
      "exemption_total": 0,
      "credit_total": 18200000,
      "nongteuk": 3640000,
      "min_tax_adj": 2100000,
      "net_refund": 12460000
    },
    "difference": 8680000,
    "selection_reason": "그룹 A가 8,680,000원 유리",
    "application_order": ["감면(§7)", "이월불가공제(§29의8)", "이월가능공제(§10)"]
  },
  "refund_calculation": {
    "original": {"calculated_tax": 45000000, "deductions_total": 0, "determined_tax": 45000000, "paid_tax": 45000000},
    "amended": {"calculated_tax": 45000000, "deductions_total": 24300000, "minimum_tax_adj": 0, "nongteuk_total": 3160000, "determined_tax": 23860000},
    "refund_amount": 21140000,
    "refund_interest": {"start_date": "2025-04-01", "end_date": "2026-03-15", "rate": 0.0803, "amount": 1623000},
    "local_tax": {"amount": 2114000, "separate_claim_required": true},
    "total_expected": 24877000,
    "carryover_items": []
  },
  "inspection_log": [
    {"code": "사전", "name": "경정청구 기한", "legal_basis": "국기법 45조의2", "judgment": "적격", "summary": "5년 이내 확인"},
    {"code": "1", "name": "그룹별 비교 분석", "legal_basis": "조특법 전반", "judgment": "완료", "summary": "그룹 A 선택 (8,680,000원 차이)"}
  ],
  "post_management": [
    {
      "provision": "조특법 §29의8",
      "obligation": "2년간 고용 유지",
      "period_start": "2025-01-01",
      "period_end": "2026-12-31",
      "violation_action": "공제세액 추징",
      "potential_clawback": 15800000,
      "interest_surcharge": 1269540,
      "risk_level": "중"
    }
  ],
  "additional_checks": [
    {"check_id": 1, "description": "R&D 전담부서 인력 자격 변동 여부 확인", "reason": "전담인력 명세 미포함", "related_inspection": "22", "priority": "상"}
  ]
}
```

---

## 7. 보고서 체크리스트 ↔ 설계서 매핑 (가이드 부록)

> 가이드 부록 "레포트 작성 체크리스트" 15건과 v2.0 설계서 검증 규칙(V/C/B/L/X)의 매핑.

| 체크 No | 확인 사항 | 대응 설계서 요소 | 자동/수동 |
|---------|----------|-----------------|----------|
| 1 | 경정청구 기한(5년) 도과 확인 | M3-01 사전검증 + V01 | 자동 (filing_deadline + 5Y 비교) |
| 2 | 중소기업 해당 여부 과세연도별 판단 | M3-02 + M7-01 (연도별 재판단) | 자동 |
| 3 | 10원 미만 절사 적용 | MX-05 절사정책 + C01 | 자동 (모든 계산 단계) |
| 4 | 비율·인원수 소수점 3자리 절사 | MX-05 + C02 | 자동 |
| 5 | 농특세 20% 차감 반영 | M5-04 + X06 농특세 교차검증 | 자동 (REF_NONGTEUKSE 참조) |
| 6 | 상호배제 교차 검증 | M5-01 + OUT_EXCLUSION_VERIFICATION | 자동 (위반 시 Hard Fail) |
| 7 | 적용순서 준수 | M5-05 + B05 (CORP: §59, INC: §60) | 자동 |
| 8 | 최저한세 후 이월공제 대상 구분 | M5-03/P5-01 + OUT_CARRYFORWARD_PLAN | 자동 |
| 9 | 제7조 이월 불가 반영 | OUT_INDIVIDUAL_CREDIT.is_carryforward = FALSE | 자동 |
| 10 | 환급액 산출 공식 | M6-01 + F01 (기존납부 - 경정후) | 자동 |
| 11 | 환급가산금 납부일 기준 | M6-02 + F06 (본세/중간예납 분리) | 자동 |
| 12 | 과세연도 기준 법령 버전 | MX-02 + REF_LAW_VERSION | 자동 |
| 13 | 필요 증빙 서류 목록 | OUT_INDIVIDUAL_CREDIT.required_documents | 반자동 (기준목록 + 수동보완) |
| 14 | 사후관리 의무 안내 | M7-03 + OUT_RISK_ASSESSMENT | 자동 |
| 15 | JSON 필수 필드 충족 | M6-05 스키마 검증 (Lv3 6-11) | 자동 |

---

## 8. 점검코드 ↔ 설계서 모듈 매핑표 (OUT_INSPECTION_LOG 초기 데이터)

> 가이드 섹션 E의 25개 점검코드와 v2.0 설계서 모듈의 1:1 매핑. OUT_INSPECTION_LOG 레코드 생성 기준.

| 점검코드 | 항목명 | 근거법령 | 설계서 모듈 | 판정값 enum |
|----------|--------|---------|------------|------------|
| 사전 | 경정청구 기한 | 국기법 §45의2 | M3-01 | 적격/기한도과 |
| 1 | 그룹별 비교 분석 | 조특법 전반 | M5-02 | 완료 |
| 2 | 소재지 점검 | 수도권정비법 §2 | M3-03 / P3-01 | 완료 |
| 3 | 농특세 부담 | 농특세법 §2,5 | M5-04 | 반영 |
| 4 | 농특세 예외 | 농특세법 §4③ | M5-04 | 반영 |
| 5 | 최저한세 | 조특법 §132 | M5-03 / P5-01 | 영향/무영향 |
| 6 | 중복불가 확인 | 조특법 §127④ | M5-01 | 위반없음/위반 |
| 7 | 중복가능 확인 | 조특법 §127④ | M5-01 | 활용 |
| 8 | 금액계산 원칙 | 국기법 §47 | MX-05 | 적용 |
| 9 | 비율계산 원칙 | 조특법 시행령 | MX-05 | 적용 |
| 9-2 | 중소기업 판단 | 조특법 시행령 §2 | M3-02 | 해당/미해당/졸업유예 |
| 9-3 | 적용순서 결정 | 법인세법 §59 / 소득세법 §60 | M5-05 | 완료 |
| 9-4 | 기존신고 확인 | 국기법 §45의2 | M3-01 | 완료 |
| 9-5 | 환급가산금 | 국기법 §52 | M6-02 | 산출 |
| 10~13 | 통합투자세액공제 | 조특법 §24 | M4-01 | 적용/해당없음 |
| 14~16 | 통합고용세액공제 | 조특법 §29의8 | M4-02 | 적용/해당없음 |
| 17~18 | 사회보험료 세액공제 | 조특법 §30의4 | M4-03 | 적용/해당없음 |
| 19 | 고용증대 세액공제 | 조특법 §29의7 | M4-02 (경과규정) | 적용/해당없음 |
| 20~21 | 창업중소기업 감면 | 조특법 §6 | M4-04 | 적용/해당없음 |
| 22~23 | 연구인력개발비 | 조특법 §10 | M4-06 | 적용/해당없음 |
| 24~25 | 중소기업특별감면 | 조특법 §7 | M4-05 | 적용/해당없음 |

**개인사업자(INC) 추가 점검코드 제안**:

| 점검코드 | 항목명 | 근거법령 | 설계서 모듈 |
|----------|--------|---------|------------|
| P-1 | 소득공제 누락분 점검 | 소득세법 §50~54 | P4-01 |
| P-2 | 성실사업자 공제 | 조특법 §122의3 | P4-04 |
| P-3 | 기장세액공제 | 소득세법 §56의2 | P4-06 |
| P-4 | 착한 임대인 공제 | 조특법 §99의9 | P4-08 |
| P-5 | 공동사업자 소득배분 | 소득세법 §43 | P4-03 |
| P-6 | 성실신고확인대상 판정 | 소득세법 §70의2 | P3-02 (★v1.1) |
| P-7 | 건강보험료 3분류 | 소득세법 §52 | P4-01b (★v1.1) |

---

## 9. 검증 규칙 추가 (v2.1)

| 코드 | 유형 | 규칙 | 검증 시점 | 조치 |
|------|------|------|----------|------|
| **V20** | 입력 | OUT_ELIGIBILITY_DIAGNOSIS.overall_status ≠ NULL | M6-04 진입 전 | Fail: 진단 미완료 |
| **B12** | 업무 | OUT_INSPECTION_LOG 레코드 수 ≥ 15 (필수 점검항목 최소 수) | M6-05 진입 전 | Warning: 점검 누락 |
| **X14** | 교차 | JSON report의 candidate_items[].item_id 전체가 OUT_INDIVIDUAL_CREDIT에 존재 | M6-05 직렬화 시 | Fail: 매핑 불일치 |
| **X15** | 교차 | refund_calculation.total_expected = refund_amount + interest + local_tax | M6-05 | Fail: 합계 불일치 |
| **X16** | 교차 | inspection_log[] 점검코드 = 가이드 25개 + INC P-1~P-7 (세목별) 완전 커버 | M6-05 | Warning: 누락 |
| **X17** | 교차 | post_management[].interest_surcharge 산출에 F-COM-01 공식 적용 | M6-05 | Fail: ★v1.1 공식 미적용 |

---

## 10. 기능 분할도 업데이트

### v2.1 M6 모듈 변경분

```
├─[Lv1] M6. 최종 환급액 산출 및 보고 (STEP 4~5) ─────────────────────
│  ├─[Lv2] M6-01 환급액 비교표 생성
│  ├─[Lv2] M6-02 환급가산금 산출
│  ├─[Lv2] M6-03 지방소득세 환급 안내
│  ├─[Lv2] M6-04 최종 보고서 생성 (3종 × 7섹션) ★v2.1 재구조화
│  │  ├─[Lv3] 5-0 데이터 수집: OUT_ELIGIBILITY/CREDIT/COMBINATION/EXCLUSION/REFUND/LOG/RISK/CHECK 조회 ★v2.1
│  │  ├─[Lv3] 5-1 보고서A: 경영진용 요약 (섹션 A+C결론+D요약+F핵심)
│  │  ├─[Lv3] 5-2 보고서B: 세무대리인용 상세 (섹션 A~F 전체)
│  │  └─[Lv3] 5-3 보고서C: 국세청 제출용 (섹션 A양식+D전체+첨부)
│  └─[Lv2] M6-05 JSON Export (제출용 데이터 생성) ★v2.1 신설
│     ├─[Lv3] 6-1~6-10 테이블→JSON 객체 매핑 (10개 객체)
│     └─[Lv3] 6-11 JSON 스키마 검증 + 직렬화
```

---

## 11. 가이드 초안 대비 피드백 (설계 관점)

> 출력양식 가이드가 초안임을 감안하여, 설계서 관점에서 가이드의 개선 제안사항을 정리합니다.

| No | 가이드 현 상태 | 설계서 기반 제안 | 근거 |
|----|--------------|----------------|------|
| 1 | 섹션 A: 법인/개인 구분 없이 단일 양식 | **tax_type 분기 필요**: 법인은 이월결손금·연결납세, 개인은 성실신고·기장유형·공동사업 표시 필요 | v2.0 §1.2 적용범위 차이 |
| 2 | 섹션 B: 항목 ID 체계 미정의 | **ITEM-{조문번호} 코드 체계 제안**: 가이드·JSON·설계서 간 일관된 ID 필요 | §3.2 보강 item_id 표 참조 |
| 3 | 섹션 C: 배제 매트릭스가 5×5 고정 | **동적 매트릭스 필요**: candidate_items 중 applicable 항목만으로 동적 생성, REF_MUTUAL_EXCLUSION 참조 | v2.0 §4.5 REF_MUTUAL_EXCLUSION |
| 4 | 섹션 D: 농특세 비과세 = "제6조, 제7조, 제10조" | **제10조는 부분 비과세**: 국가전략기술 R&D만 비과세, 일반 R&D는 과세 → 가이드 수정 필요 | v4.0r1 E08 오류수정 (농특세법 §4③) |
| 5 | 섹션 D: 중간예납 환급가산금 분리 미반영 | **v2.0 I12 적용 필요**: 본세와 중간예납의 기산일이 다름 → 가이드에 분리 표시 추가 | v2.0 M6-02 |
| 6 | 섹션 E: 점검 9-3 적용순서 = "법인세법 59조" 고정 | **세목 분기 필요**: INC는 소득세법 §60 → 가이드에 조건부 표시 | v2.0 §1.3 핵심원칙 |
| 7 | 섹션 F: 이자상당가산액 미언급 | **★v1.1 F-COM-01 반영 필요**: 단순 "공제세액 추징"이 아니라 원금+이자상당가산액 | v1.1 보완 ⑤ |
| 8 | 섹션 G: taxpayer_info에 법인 전용 필드 부족 | **corp_id, biz_income, non_taxable, loss_carryforward 등 추가** | v2.0 TBL_CORP_BASIC |
| 9 | 부록 체크리스트: 15개 (법인 중심) | **개인 전용 체크항목 추가 제안**: 추계신고 배제, 성실신고 확인, 소득공제 누락 등 | v2.0 PART III 검증규칙 |
| 10 | 전체: 단일 과세연도 전제 | **다수 과세연도 시뮬레이션(M7) 결과 표시 구조 필요**: 연도별 report 배열 또는 summary | v2.0 M7-01 |

---

## 12. 보완 항목 총괄표

| No | 구분 | 항목 | 가이드 섹션 | v2.0 위치 | 변경 유형 |
|----|------|------|-----------|----------|----------|
| 1 | 출력 테이블 | OUT_ELIGIBILITY_DIAGNOSIS | A | §5 (신설) | 신설 26컬럼 |
| 2 | 출력 테이블 | OUT_EXCLUSION_VERIFICATION | C-2 | §5 (신설) | 신설 10컬럼 |
| 3 | 출력 테이블 | OUT_INSPECTION_LOG | E | §5 (신설) | 신설 11컬럼 |
| 4 | 출력 테이블 | OUT_ADDITIONAL_CHECK | F-2 | §5 (신설) | 신설 8컬럼 |
| 5 | 출력 테이블 | OUT_INDIVIDUAL_CREDIT | B | §5.2 | 7컬럼 추가 |
| 6 | 출력 테이블 | OUT_FINAL_REFUND | D | §5.5 | 5컬럼 추가 |
| 7 | 출력 테이블 | OUT_RISK_ASSESSMENT | F-1 | §5.8 | 3컬럼 추가 |
| 8 | 모듈 | M6-04 보고서 3종×7섹션 | A~F | §2.1 FDD | 재구조화 |
| 9 | 모듈 | M6-05 JSON Export | G | §2.1 FDD (신설) | 신설 11서브 |
| 10 | JSON 스키마 | 10개 객체 정의 | G-2 | §없음 (신설) | 완전 신설 |
| 11 | REST API | 7개 엔드포인트 | G (연동) | I15 구체화 | 완전 신설 |
| 12 | 검증 규칙 | V20, B12, X14~X17 | 부록 | §9 추가 | 6건 추가 |
| 13 | 매핑 표 | 점검코드↔모듈 (25+7건) | E | §없음 (신설) | 신설 |
| 14 | 매핑 표 | 체크리스트↔검증규칙 (15건) | 부록 | §없음 (신설) | 신설 |
| 15 | 피드백 | 가이드 초안 개선 제안 (10건) | 전체 | — | 권고 |

---

**[문서 끝]** — 통합개발상세설계서 v2.1 보완 (점검결과 출력 테이블 + 외부 전달 인터페이스)
