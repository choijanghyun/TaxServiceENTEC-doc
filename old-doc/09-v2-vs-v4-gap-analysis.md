# 07-development-design-v2.md vs 외부자료_v4_0.md Gap 분석 종합 보고서

**분석일**: 2026-02-18
**TARGET**: `old-doc/07-development-design-v2.md` (v2.0, 1,523줄)
**SOURCE**: `외부자료_v4_0.md` (v4.0, 6,792줄, 373KB)
**분석 방법**: 3개 병렬 서브에이전트 (모듈/아키텍처, 공식/계산로직, 테이블/API/검증)

---

## 1. 전체 커버리지 요약

| 분석 영역 | 가중치 | 커버리지 | 점수 | 평가 |
|----------|:------:|:--------:|:----:|:----:|
| **테이블 스키마** (83+1뷰) | 15% | 100% | 15.0 | ✅ FULL |
| **API 엔드포인트** (8→11) | 10% | 138% | 10.0 | ✅ FULL+ |
| **검증 규칙** (107개) | 10% | 100% | 10.0 | ✅ FULL |
| **req_id 관리** | 5% | 100% | 5.0 | ✅ FULL |
| **오류 코드 체계** (8개) | 5% | 100% | 5.0 | ✅ FULL |
| **M4 개별공제** (30→31개) | 10% | 103% | 10.0 | ✅ FULL+ |
| **M5 최적조합** (B&B/Greedy) | 8% | 100% | 8.0 | ✅ FULL |
| **M3-PREP 데이터 준비** | 5% | 100% | 5.0 | ✅ FULL |
| **트랜잭션 경계** (TX-1/2) | 5% | 100% | 5.0 | ✅ FULL |
| **세율표** (2018~2025) | 5% | 90% | 4.5 | ✅ |
| **공식 정의** (F01~41, F-INC) | 7% | 70% | 4.9 | ⚠️ |
| **모듈 계층** (M0~MX, P-) | 5% | 64% | 3.2 | ⚠️ |
| **계산 단계 상세** (STEP 0~5) | 3% | 60% | 1.8 | ⚠️ |
| **세부 규칙** (최저한세 등) | 3% | 54% | 1.6 | ⚠️ |
| **보안 요구사항** | 2% | 80% | 1.6 | ⚠️ |
| **성능 요구사항** | 1% | 60% | 0.6 | ⚠️ |
| **데이터 이관/ETL** | 1% | 0% | 0.0 | ❌ |
| **합계** | **100%** | | **91.2** | **A** |

### 등급 판정: **A (91.2/100)**

- 핵심 구조(테이블/API/검증/req_id/M4/M5): **100% 완전 반영**
- 보조 구조(모듈계층/공식상세/세부규칙): **60~70% 부분 반영**
- 운영 요소(ETL/보안/성능): **보완 필요**

---

## 2. 완전 반영 영역 (Coverage 100%)

### 2.1 테이블 스키마 - 83개 + 뷰 1개 전체 반영

| 주제영역 | 접두어 | 수량 | 상태 |
|---------|-------|:----:|:----:|
| 요청 및 입력 상세 | RI_ | 37개 | ✅ |
| 요약 및 검증 | SV_ | 8개 | ✅ |
| 산출 결과 | CO_ | 11개 | ✅ |
| 감사 로그 | AL_ | 1개 | ✅ |
| 기준 정보 | RF_ | 26개 | ✅ |
| 뷰 | VW_ | 1개 | ✅ |

### 2.2 API 엔드포인트 - SOURCE 8개 + TARGET 3개 추가

| API | METHOD | PATH | SOURCE | TARGET |
|-----|--------|------|:------:|:------:|
| API-01~08 | - | /api/v1/... | ✅ | ✅ |
| API-09 | GET | .../credits | - | ✅ 추가 |
| API-10 | GET | .../combinations | - | ✅ 추가 |
| API-11 | GET | .../audit-log | - | ✅ 추가 |

### 2.3 검증 규칙 - 107개 전체 반영

- 공통 83개 (V19, C13, B13, L9, X21, W6): ✅
- 개인 전용 24개 (VP6, CP5, BP5, LP5, XP5): ✅
- v4.0r1 추가 12개 (V25~26, V-RD, B-SME, V-LOSS, V-EMP, V-POST, X-JSON, X18~21): ✅

### 2.4 M4 개별공제 - 31개 (SOURCE 30개 + P4-15 추가)

- 공통 8개 (M4-01~06, M4-08, M4-10): ✅
- 법인 전용 8개 (M4-07/09/11~15/42): ✅
- 개인 전용 15개 (P4-01~P4-15): ✅ (SOURCE보다 P4-15 추가)

### 2.5 M5 최적조합 - 완전 일치

- M5-01~05 + P5-01: ✅
- B&B/Greedy 임계값 15개: ✅
- 상호배제 10규칙: ✅
- R&D 3단계 배제 순서: ✅

### 2.6 기타 완전 일치 항목

- M3-PREP 6단계: ✅
- M3-00~06 사전점검 7개: ✅
- P3-01~04 개인점검 4개: ✅
- 트랜잭션 TX-1(60s)/TX-2(300s): ✅
- req_id 형식 및 동시성 제어: ✅
- 오류 코드 8개: ✅
- 절사(TRUNCATE) 정책: ✅
- 감사 로그 AL_S_CALCULATION: ✅

---

## 3. 누락 항목 (SOURCE에 있으나 TARGET에 없음)

### 3.1 Critical (즉시 보완 필요) - 6건

| No | 항목 | SOURCE 위치 | 상세 내용 |
|----|------|------------|----------|
| **C-01** | **M1-04~M1-12 (9개 서브모듈)** | §2.3 M1 | 투자자산(M1-04), 창업(M1-05), R&D(M1-06), 이월결손금(M1-07), 이월세액(M1-08), 기존신고(M1-09), 지점소재지(M1-10), 중간예납(M1-11), 수입배당금(M1-12) 검증 로직 |
| **C-02** | **P1-01~P1-08 (8개 개인입력모듈)** | §2.3 P1 | 기본정보(P1-01), 사업장(P1-02), 기타소득(P1-03), 소득공제(P1-04), 성실신고(P1-05), 외국납부(P1-06), 착한임대인(P1-07), 공동사업자(P1-08) |
| **C-03** | **F11: 통합고용 추가공제** | §39.1.2 | 경력단절재고용·정규직전환·육아복귀 공제 공식 (중소 1,300만/중견 900만) |
| **C-04** | **F-COM-01: 사후관리 추징액** | §39.2.6, §39.3 | 본세추징→경과일수→이자상당가산액→총추징액 4단계 계산 |
| **C-05** | **R&D 최저한세 배제 3단계** | §39.1.5 | 국가전략 100%, 신성장 중소 100%, 일반 중소 50% (RF_C_RD_MIN_TAX_EXEMPT) |
| **C-06** | **외부 참조 데이터 갱신 프로세스** | 부록 C | 환율(일일), 인정이자율(월별), 인구감소지역(연간), KSIC(수시), 법령버전(개정시), 환급이율(변동시) |

### 3.2 Major (중요 보완 필요) - 11건

| No | 항목 | SOURCE 위치 | 상세 내용 |
|----|------|------------|----------|
| **M-01** | M2 기준정보 관리 모듈 (13개) | §2.3 M2 | M2-01(법인세율)~M2-13(인구감소지역) 관리 로직 |
| **M-02** | M0 분기 모듈 (2개) | §2.3 M0 | M0-01 TAX_TYPE 자동분기, M0-02 법령버전 사전결정 |
| **M-03** | M6-06 API 응답 반환 | §2.3 M6 | M6-05(JSON직렬화) 이후 API 응답 단계 |
| **M-04** | M7-02 이월최적화 시뮬레이션 | §2.3 M7 | 10년 이월공제 활용 시나리오 |
| **M-05** | MX-04 감사추적 | §2.3 MX | AL_S_CALCULATION 활용 로직 |
| **M-06** | Idempotency-Key 헤더 처리 | §33.3 | API-01 중복 요청 방지 |
| **M-07** | 상시근로자 수 산정 공식 | §39.1.5.2 | TRUNCATE(평균, 2), 청년등 분리 |
| **M-08** | 결손금 소급공제 환급액 공식 | §39.1.5.9 | 4단계 계산 과정 |
| **M-09** | 감면율 결정 테이블 | RF_S_SME_DEDUCTION_RATE | 업종/소재지/규모별 5~30% |
| **M-10** | SSE/WebSocket 실시간 진행률 | §33.1 | Polling 대안의 실시간 인터페이스 |
| **M-11** | 민감정보 마스킹 정책 | §33.1 | 사업자번호·대표자 식별정보 마스킹 |

### 3.3 Minor (검토/보강 필요) - 8건

| No | 항목 | 상세 |
|----|------|------|
| m-01 | MX-05 절사정책 모듈 | §6.3에서 별도 정의, 모듈화 여부 검토 |
| m-02 | M7-04 시뮬레이션 서브모듈 | SOURCE 존재 확인, 기능 미확인 |
| m-03 | 최저한세율 구간 경계 | 중견·대: 100억/1,000억 기준 3단계 미명시 |
| m-04 | 공동사업자 처리 공식 | 손익분배비율 적용 상세 |
| m-05 | 다사업장 감면 배분 | TRUNCATE(비율, 4) 규칙 |
| m-06 | 인구감소지역 100% 감면 | 2025년~ 신규 적용 |
| m-07 | 제29조의7 경과규정 비교 | 2023~2024년 한정 |
| m-08 | DBMS별 인덱스 대안 | 부록 D 내용 |

---

## 4. 불충분 항목 (TARGET에 있으나 상세도 부족)

| No | 항목 | SOURCE 상세도 | TARGET 상세도 | Gap 정도 |
|----|------|:-------------|:-------------|:--------:|
| I-01 | M1-03 PHASE 의사코드 | 2,000줄 (PHASE별 200~500줄) | 400줄 (요약) | 80% 부족 |
| I-02 | M4 의사코드 (§36.1) | 18개 서브모듈 상세 | §13 부록 일부만 | 50% 부족 |
| I-03 | STEP 2 세부 절차 | 22개 서브모듈 각 6~10단계 | 모듈만 나열 | 70% 부족 |
| I-04 | M3-PREP 의사코드 | PREP-1~6 각 100줄 | 테이블 1행 | 90% 부족 |
| I-05 | M6-01~04 산출식 | 각 모듈 의사코드 | 테이블 1행 | 70% 부족 |
| I-06 | 통합투자 추가공제 | 3년평균 초과분 8단계 | 간략 언급 | 60% 부족 |
| I-07 | 상호배제 조건부 규칙 | year_from/to/condition 상세 | 주요 배제만 | 40% 부족 |
| I-08 | 농특세 과세/비과세 | 6개 조항 + 실질환급률 | 기본만 | 30% 부족 |

---

## 5. TARGET이 SOURCE보다 개선된 항목

| No | 항목 | SOURCE | TARGET | 개선 내용 |
|----|------|--------|--------|----------|
| P-01 | API 엔드포인트 | 8개 | **11개** | API-09~11 추가 (개별 조회) |
| P-02 | 보고서 섹션 | A~F (6개) | **A~H (8개)** | 제출데이터/감사로그 섹션 추가 |
| P-03 | M4 개인공제 | P4-01~14 | **P4-01~15** | P4-15 신규 추가 |
| P-04 | JWT + RBAC | 미명시 | **명시적 채택** | 인증/인가 전략 구체화 |
| P-05 | Clean Architecture | 개념적 | **4계층 상세** | Presentation/Application/Domain/Infrastructure |
| P-06 | E2E 테스트 | 미명시 | **상세 시나리오** | 법인/개인 플로우 시나리오 |
| P-07 | TruncationPolicy | 규칙만 | **Java 클래스 코드** | 구현 코드 제공 |

---

## 6. 영역별 상세 분석 결과

### 6.1 모듈/아키텍처 (73.5%)

```
강점: M3-PREP(100%), M4(103%), M5(100%), TX경계(100%), 오류처리(100%)
약점: M0(0%), M1 서브(25%), M2(0%), P1(0%), MX 일부(60%)
```

**모듈 전수 현황**:
- SOURCE 총 서브모듈: 95개 (M+P 포함)
- TARGET 총 서브모듈: 61개
- 커버리지: 64.2%

### 6.2 공식/계산로직 (65%)

```
강점: 법인공식 F01~F41 기본(89%), 개인공식 F-INC(100%), 세율표(90%)
약점: 상세보충공식(30%), 계산단계(60%), 세부규칙(54%)
```

**공식별 현황**:
- F01~F41: 19개 중 17개 반영 (89%) - F11 누락
- F-INC-01~11: 11개 전체 반영 (100%) - 상세도 SOURCE 우위
- F-COM-01: 완전 누락 (0%)

### 6.3 테이블/API/검증 (92.9%)

```
강점: 테이블(100%), API(138%), 검증규칙(100%), req_id(100%), 오류코드(100%)
약점: 데이터이관(0%), 보안상세(80%), 성능상세(60%)
```

---

## 7. 우선순위별 보완 권고

### 7.1 Phase 1 필수 보완 (구현 전 즉시)

| 순서 | 항목 | 예상 분량 | 근거 |
|:----:|------|:--------:|------|
| 1 | F11 통합고용 추가공제 공식 추가 | 20줄 | M4-02 산출에 직접 영향 |
| 2 | F-COM-01 사후관리 추징액 공식 추가 | 30줄 | M7-03 리스크 산출에 필수 |
| 3 | R&D 최저한세 배제 3단계 규칙 추가 | 15줄 | M5-03 최저한세 적용에 필수 |
| 4 | Idempotency-Key 처리 명시 | 10줄 | API-01 중복요청 방지 필수 |
| 5 | 외부 데이터 갱신 프로세스 기본 명세 | 30줄 | RF_* 테이블 운영에 필수 |

### 7.2 Phase 1 권장 보완 (구현 초기)

| 순서 | 항목 | 예상 분량 |
|:----:|------|:--------:|
| 6 | M1-04~12 입력검증 서브모듈 추가 | 100줄 |
| 7 | P1-01~08 개인입력 모듈 추가 | 80줄 |
| 8 | 상시근로자 산정 + 결손금 소급공제 공식 | 30줄 |
| 9 | 최저한세율 구간 경계 상세화 | 10줄 |
| 10 | 감면율 결정 테이블 추가 | 20줄 |

### 7.3 Phase 2 보강 (구현 후)

| 순서 | 항목 |
|:----:|------|
| 11 | M2 기준정보 관리 모듈 설계 |
| 12 | M0 분기 모듈 명시 |
| 13 | SSE/WebSocket 실시간 진행률 |
| 14 | 민감정보 마스킹 정책 |
| 15 | 성능/보안 테스트 전략 |

---

## 8. 결론

### 8.1 종합 평가

`07-development-design-v2.md`는 `외부자료_v4_0.md`의 **핵심 설계를 91.2% 수준으로 반영**하고 있으며, 특히 **테이블 스키마(100%)**, **API(138%)**, **검증 규칙(100%)**, **M4 개별공제(103%)**, **M5 최적조합(100%)** 등 구현의 핵심 영역에서 완전한 커버리지를 달성하였습니다.

### 8.2 핵심 성과

1. SOURCE의 83개 테이블 + 107개 검증 규칙 **100% 완전 반영**
2. API 11개로 확장, 보고서 8섹션으로 확장 (SOURCE 대비 개선)
3. M4 31개 서브모듈로 SOURCE보다 1개 추가
4. 트랜잭션/req_id/오류코드/절사정책 **완전 일치**

### 8.3 보완 필요 사항

1. **Critical 6건**: F11, F-COM-01, R&D 배제, M1 서브모듈, P1 모듈, ETL 프로세스
2. **Major 11건**: M0/M2 모듈, Idempotency-Key, 상세 공식 등
3. **상세도 부족 8건**: 의사코드/절차 수준의 상세화 필요 (SOURCE 6,792줄 vs TARGET 1,523줄)

### 8.4 최종 판정

> **TARGET 문서는 SOURCE의 구조적 설계를 충실히 반영**하되, 6,792줄을 1,523줄로 **압축하는 과정에서 모듈 계층 일부(M0/M1서브/M2/P1)와 상세 공식·절차가 누락**되었습니다.
> **Critical 6건을 우선 보완**하면 구현에 필요한 충분한 설계 문서로 활용 가능합니다.

---

**작성**: 3개 병렬 분석 에이전트 종합
**문서 버전**: v1.0
**총 분석 소요**: 약 5분 (3 에이전트 병렬 실행)
