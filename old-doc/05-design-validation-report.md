# 개발설계서 검증 보고서

> **검증 대상**: `old-doc/04-development-design.md` (v1.0, 1,211줄, 12개 섹션)
> **검증일**: 2026-02-17
> **검증자**: Design Validator Agent
> **검증 기준 문서**:
> - Plan: `docs/01-plan/features/tax-refund-system.plan.md` (55 FR)
> - Glossary: `old-doc/01-glossary.md`
> - Schema: `old-doc/02-entity-schema.md` (83 tables + 1 view)
> - ERD: `old-doc/03-entity-relationship.md`
> - External Ref: `외부자료_v4_0.md` (v4.0 원본 상세설계)

---

## 종합 결과

| 항목 | 점수 | 판정 |
|------|:----:|:----:|
| **종합 커버리지** | **82 / 100** | **구현 가능 (Warning 항목 개선 후)** |
| 요구사항 커버리지 | 51/55 FR | 93% |
| 스키마 정합성 | 83/83 테이블 | 100% |
| 모듈 완전성 | 42/52 서브모듈 | 81% |
| API 정합성 | 8/8 엔드포인트 | 100% |
| 계산 공식 완전성 | 33/39 공식 | 85% |
| 검증 규칙 완전성 | 75/95 규칙 | 79% |
| 내부 일관성 | 11/13 항목 | 85% |

---

## 1. 요구사항 커버리지 (FR-01 ~ FR-55)

### 결과: 51/55 커버 (93%) -- Warning

#### 커버된 FR (51개)

| 범위 | FR 목록 | 설계서 매핑 |
|------|---------|-----------|
| 입력 관리 | FR-01~FR-10 | 섹션 3.2 (M1-01~M1-03), 섹션 4.3 (API-01), 섹션 2.2 패키지 구조 |
| 사전 점검 | FR-11~FR-16, FR-17~FR-20 | 섹션 3.3~3.4 (M3-PREP, M3-00~M3-06, P3-01~P3-04) |
| 개별 공제/감면 | FR-21~FR-24, FR-26~FR-28, FR-33~FR-35 | 섹션 3.5 (M4 서브모듈), 표 참조 |
| 최적 조합 | FR-36~FR-45 | 섹션 3.6 (M5-01~M5-05, P5-01) |
| 최종 산출 | FR-46~FR-50, FR-53~FR-54 | 섹션 6 (계산 엔진), 섹션 8 (보고서), 섹션 5 (파이프라인) |
| 시뮬레이션 | FR-55 | 섹션 3.1 (M7-01, M7-03) |

#### 누락된 FR (4개)

| FR ID | 요구사항 | 심각도 | 누락 상세 | 권고 |
|-------|---------|:------:|----------|------|
| **FR-25** | 사회보험료세액공제 (SS30의4, ~2024년) | Major | M4-03이 모듈 계층 구조(섹션 3.1)에는 나열되어 있으나, 섹션 3.5의 "주요 서브모듈 설계" 상세표에 M4-03 행이 누락됨. 입출력/핵심 로직 상세 없음. | 섹션 3.5에 M4-03 상세 설계 추가 필요 |
| **FR-29** | 이월결손금 재검토 (법인세법 SS13) | Major | 외부자료의 M4-08에 해당하지만 설계서에는 M4-08이 전혀 언급되지 않음. Phase 2에도 "이월결손금"으로만 기술. | M4-08 상세 설계 추가 (또는 Phase 2 명시) |
| **FR-51** | 추가 확인 필요 항목 안내 (CO_S_ADDITIONAL_CHECK) | Minor | CO_S_ADDITIONAL_CHECK 테이블이 보고서 섹션(8.1 section F)에 참조되나, 생성 로직의 상세 설계가 없음. | M6 또는 M3 단계에서 생성 로직 명시 |
| **FR-52** | 사후관리 리스크 평가 | Minor | CO_S_RISK가 보고서에 참조되나, M7-03에 대한 상세 설계가 Phase 2로만 기술됨. 리스크 평가 기준/점수화 방법 없음. | Phase 2 범위 명확화 또는 M7-03 기초 설계 추가 |

---

## 2. 스키마 정합성 (83 테이블)

### 결과: 83/83 매핑 완료 (100%) -- Pass

설계서의 데이터 규모 표(섹션 1.4)가 02-entity-schema.md와 정확히 일치합니다.

| 주제영역 | 접두어 | C (법인) | I (개인) | S (공동) | 합계 | 정합성 |
|----------|--------|:--------:|:--------:|:--------:|:----:|:------:|
| 요청 및 입력 | RI_ | 17 | 8 | 12 | 37 | Pass |
| 요약 및 검증 | SV_ | - | - | 8 | 8 | Pass |
| 산출 결과 | CO_ | - | 3 | 8 | 11 | Pass |
| 감사 로그 | AL_ | - | - | 1 | 1 | Pass |
| 기준 정보 | RF_ | 7 | 4 | 15 | 26 | Pass |
| **합계** | | 24 | 15 | 44 | **83** + 뷰 1 | **Pass** |

#### 모듈-테이블 매핑 검증

| 모듈 | 입력 테이블 | 출력 테이블 | 참조 테이블 | 정합성 |
|------|-----------|-----------|-----------|:------:|
| M1-03 | RI_S_RAW_DATA | SV_S_BASIC, SV_S_EMPLOYEE, SV_S_DEDUCTION, SV_S_FINANCIAL | - | Pass |
| M3-PREP | SV_* 4개 | SV_S_PREP_SUMMARY | RF_S_LAW_VERSION, RF_S_TAX_RATE | Pass |
| M3-00~06 | SV_S_BASIC, SV_S_PREP_SUMMARY | SV_S_ELIGIBILITY, SV_S_INSPECTION_LOG, SV_S_VALIDATION_LOG | RF_S_CAPITAL_ZONE 등 | Pass |
| M4-01~15 | SV_S_DEDUCTION, SV_S_EMPLOYEE | CO_S_CREDIT_DETAIL | RF_C_* 등 | Pass |
| M5-01~05 | CO_S_CREDIT_DETAIL | CO_S_COMBINATION, CO_S_EXCLUSION_VERIFY | RF_S_MUTUAL_EXCLUSION 등 | Pass |
| M6-01~05 | CO_S_COMBINATION | CO_S_REFUND, CO_S_RISK, CO_S_REPORT_JSON | RF_S_REFUND_INTEREST_RATE | Pass |

**Warning 1건**: 03-entity-relationship.md의 M3-PREP 참조 테이블에 `RF_I_TAX_RATE`가 포함되어 있으나, 설계서 섹션 5.3에서는 `RF_S_LAW_VERSION, RF_S_TAX_RATE`만 명시. 개인 세율 참조 누락.

---

## 3. 용어 일관성

### 결과: 11/13 항목 Pass -- Warning

| 검증 항목 | 결과 | 상세 |
|----------|:----:|------|
| 경정청구 | Pass | 일관 사용 |
| req_id | Pass | 생성 규칙 일치 (C-XXXXXXXXXX-YYYYMMDD-NNN) |
| TAX_TYPE (CORP/INC) | Pass | 일관 사용 |
| 절사(Truncate) 원칙 | Pass | 금액 10원, 비율 3자리, 가산금 1원 |
| 최저한세 | Pass | CORP: 과세표준 기준, INC: 산출세액 기준 구분 명확 |
| 적용순서 | Pass | 감면->이월불가->이월가능 일관 |
| 상호배제 | Pass | 조특법 SS127SS4 준수 |
| 결산조정/신고조정 | Pass | Hard Fail 구분 일치 |
| 원본 불변성 | Pass | INSERT ONLY 명시 |
| Request-Driven 모델 | Pass | req_id 관통 키 일치 |
| **req_id 신청인구분 코드** | **Fail** | **외부자료: C=법인, P=개인. 설계서: C=법인, I=개인. glossary: C=법인, I=개인. 설계서와 glossary는 일치하나, 외부자료와 불일치** |
| **검증 규칙 건수 표기** | **Warning** | **설계서 섹션 2.1 "71개 검증 규칙"과 섹션 7.1 "83개"가 혼용. 외부자료는 "공통 71건 + 개인 전용 12건 = 83건"으로 정의. 섹션 2.1의 "71개"는 공통만 의미하는 것으로 보이나 명시적 구분 없음** |
| **MX-03 검증 엔진 건수** | **Warning** | **섹션 7.1 제목 "83개 규칙"이나 실제 상세에는 V(19)+C(13)+B(11)+L(9)+X(13)+W(6)=71개 + 개인12건 = 83건. 외부자료 v4.0에는 V(23)+C(13)+B(13)+L(9)+X(21)+W(5)=84건 공통 + 24건 개인 = 최대 108건. 버전 차이로 추정되나 정확한 카운트 확인 필요** |

---

## 4. ERD 정합성

### 결과: Pass (Minor Warning 1건)

| 검증 항목 | 결과 | 상세 |
|----------|:----:|------|
| 최상위 관계 (RI_S_APPLICANT/TAXPAYER -> RI_S_REQUEST) | Pass | 1:N 관계 일치 |
| 입력-요약 관계 (RI_S_RAW_DATA -> SV_*) | Pass | M1-03 파싱 흐름 일치 |
| 요약-점검 관계 (SV_* -> SV_S_PREP_SUMMARY 등) | Pass | M3-PREP 흐름 일치 |
| 산출 결과 관계 (CO_S_CREDIT_DETAIL -> CO_S_COMBINATION) | Pass | M4->M5->M6 흐름 일치 |
| 개인 전용 산출 (CO_I_*) | Pass | P3, P4 모듈 매핑 일치 |
| 3계층 데이터 아키텍처 | Pass | 설계서 섹션 2.3과 ERD 일치 |
| **RF_* 참조 관계** | **Warning** | 03-entity-relationship.md에 RF_I_TAX_RATE, RF_I_MIN_TAX 참조가 있으나, 설계서의 모듈-테이블 매핑(섹션 5.3)에서 개인 전용 RF 참조가 명시적으로 나열되지 않음 |

---

## 5. 모듈 완전성 (외부자료 v4.0 대비)

### 결과: 42/52 서브모듈 커버 (81%) -- Warning

#### 외부자료 v4.0 전체 모듈 목록 vs 설계서 매핑

**M0 세목 분기 (2개)**

| 모듈ID | 기능명 | 설계서 반영 | 상세 |
|--------|--------|:---------:|------|
| M0-01 | 납세자 유형 선택 | Warning | TAX_TYPE 분기 매트릭스(섹션 2.4)에 암묵적으로 포함되나, 별도 모듈 설계 없음 |
| M0-02 | 세목별 모듈/테이블/기준정보 활성화 | Warning | 동일 |

**M1 입력 관리 (12개)**

| 모듈ID | 기능명 | 설계서 반영 | 비고 |
|--------|--------|:---------:|------|
| M1-01 | req_id 발급 | Pass | 섹션 3.2 상세 |
| M1-02 | 원시 JSON 수신 | Pass | 섹션 3.2 상세 |
| M1-03 | 요약 테이블 생성 | Pass | 섹션 3.2 상세 (5 PHASE) |
| M1-04~06, 08~09 | 입력 스키마 | Pass | RI_S_RAW_DATA 카테고리로 대체 |
| M1-07, 10~12 | CORP 전용 입력 | Pass | 카테고리 코드로 매핑 |
| P1-01~P1-08 | INC 전용 입력 | **Missing** | 설계서에 개별 P1-* 모듈 언급 없음. RI_I_* 테이블은 패키지 구조에 존재하나 P1 입력 모듈 설계가 부재 |

**M2 기준정보 관리 (13개)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| M2-01~M2-09 | Pass | MX-02 법령 버전 매칭으로 통합 |
| M2-10~M2-13 | **Missing** | INC 전용 기준정보 관리 모듈(RF_I_TAX_RATE, RF_I_MIN_TAX, RF_I_DEDUCTION_LIMIT, RF_I_SINCERITY_THRESHOLD) 설계 없음. 테이블은 존재하나 관리 로직 부재 |

**M3 사전 점검 (7개 공통 + 4개 INC)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| M3-00~M3-06 | Pass | 섹션 3.4 상세 |
| P3-01~P3-04 | Pass | 섹션 3.1, 2.2 패키지 구조에 포함 |

**M4 개별 공제/감면 (18개 CORP + 14개 INC)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| M4-01~M4-07 | Pass | 섹션 3.5 상세 |
| **M4-08** | **Missing** | 이월결손금 재검토 -- 설계서에 미언급 |
| M4-09~M4-11 | Pass | 섹션 3.5 (패키지 구조) |
| **M4-12** | **Missing** | 토지등 양도세 추가과세 -- 설계서에 미언급 |
| **M4-13** | **Missing** | 기업구조조정 과세이연 -- 설계서에 미언급 |
| **M4-14** | **Missing** | 연결납세 특화 점검 -- 설계서에 미언급 |
| M4-15, M42 | Pass | 섹션 3.1, 2.2 패키지에 포함 |
| P4-01~P4-08 | Pass | 섹션 2.2 inc/ 패키지에 포함 |
| **P4-09** | **Missing** | 개인 결손금 소급공제 -- 설계서에 미언급 |
| **P4-10~P4-14** | **Missing** | 자녀세액공제, 연금저축, 전자신고, 개인 재해손실, 벤처투자 출자 -- 설계서에 미언급 (5개) |

**M5 최적 조합 (6개)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| M5-01~M5-05, P5-01 | Pass | 섹션 3.6 상세 |

**M6 최종 산출 (5개)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| M6-01, M6-02, M6-04, M6-05 | Pass | 섹션 3.1, 섹션 8 |
| **M6-03** | **Partial** | 지방소득세 안내가 M6-05 내 LocalTaxGuidance로 매핑. M6-06으로도 표기됨. 외부자료의 M6-03과 번호 불일치 |

**M7 시뮬레이션 (4개)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| M7-01, M7-03 | Pass | Phase 2로 명시 |
| **M7-02** | **Missing** | 이월공제 활용 시나리오 -- 설계서에 미언급 |
| **M7-04** | **Missing** | INC 소득공제 시나리오 비교 -- 설계서에 미언급 |

**MX 횡단 기능 (6개)**

| 모듈ID | 설계서 반영 | 비고 |
|--------|:---------:|------|
| MX-01~MX-03 | Pass | 섹션 3.7, 섹션 7 |
| **MX-04** | **Missing** | 계산 이력/감사 추적 -- AL_S_CALCULATION 테이블은 있으나 모듈 설계 없음 |
| **MX-05** | **Partial** | 절사 정책 -- TruncationPolicy 클래스(섹션 6.3)로 구현되나 별도 모듈로 설계되지 않음 |
| **MX-06** | **Missing** | 세목 분기 엔진 -- 설계서에 미언급 (M0와 유사) |

#### 누락 모듈 요약

| 심각도 | 모듈 | 비고 |
|:------:|------|------|
| Critical | P4-09 (개인 결손금 소급공제) | FR-31에 해당, F-INC-11 공식 있으나 모듈 설계 없음 |
| Major | M4-08, M4-12, M4-13, M4-14 | Phase 2 후보지만 명시적 분류 없음 |
| Major | P4-10~P4-14 (5개) | 개인 전용 소규모 공제 5개, Phase 2 명시 필요 |
| Minor | P1-01~P1-08 | API-01의 카테고리 코드로 대체 가능하나 모듈 독립성 약함 |
| Minor | M2-10~M2-13 | RF_I_* 테이블 관리 로직 |
| Minor | M7-02, M7-04, MX-04, MX-06 | Phase 2 또는 횡단 기능 |

---

## 6. API 정합성

### 결과: 8/8 엔드포인트 (100%) -- Pass

| API No | Method | Path | 외부자료 | 설계서 | 정합성 |
|--------|--------|------|---------|--------|:------:|
| API-01 | POST | /api/v1/requests | 요청 접수 + JSON 수신 | 섹션 4.2~4.3 | Pass |
| API-02 | POST | /api/v1/requests/{req_id}/analyze | 점검 실행 | 섹션 4.2 | Pass |
| API-03 | GET | /api/v1/requests/{req_id}/status | 상태 조회 | 섹션 4.2 | Pass |
| API-04 | GET | /api/v1/requests/{req_id}/report | 전체 보고서 | 섹션 4.2 | Pass |
| API-05 | GET | /api/v1/requests/{req_id}/report/sections/{A-F} | 섹션별 | 섹션 4.2 | Pass |
| API-06 | GET | /api/v1/requests/{req_id}/raw-data | 원시 JSON | 섹션 4.2 | Pass |
| API-07 | GET | /api/v1/reference/exclusion-matrix | 상호배제 기준 | 섹션 4.2 | Pass |
| API-08 | GET | /api/v1/requests/{req_id}/summary | 경량 요약 | 섹션 4.2 | Pass |

#### Warning 사항

| 항목 | 상세 |
|------|------|
| Plan 문서 API 불일치 | Plan 문서(섹션 8)에는 `PUT /api/v1/requests/{req_id}/calculate`로 기술. 설계서에는 `POST /api/v1/requests/{req_id}/analyze`로 변경. 의도적 변경으로 보이나 Plan 문서 갱신 필요 |
| 오류 코드 차이 | 외부자료에 `ERR_DUPLICATE_CATEGORY`(400), `ERR_CONCURRENT_CONFLICT`(409) 코드가 있으나 설계서 섹션 4.4에는 미포함 |
| Idempotency-Key | 설계서에 Idempotency-Key 지원을 명시하나 상세 구현 설계(Redis TTL, 중복 응답 캐시 등) 없음 |

---

## 7. 계산 공식 완전성

### 결과: 33/39 공식 반영 (85%) -- Warning

#### 법인세 공식 (F01~F34, F40~F41)

| 공식ID | 공식명 | 설계서 반영 | 위치 |
|--------|--------|:---------:|------|
| F01~F04 | 과세표준/산출세액/최저한세 | Pass | 섹션 6.1 |
| F10~F11 | 통합고용 기본/추가 | Pass | 섹션 6.1 (F10만 명시, F11은 M4-02 표에 암묵적) |
| F12~F13 | 통합투자 기본/추가 | Pass | 섹션 6.1 |
| F14~F15 | 창업/중소특별 감면 | Pass | 섹션 6.1 |
| **F16** | **중소특별 감면한도** | **Missing** | MIN(감면, MAX(0, 1억-감소인원x500만)) -- M4-05 표에 로직 기술 있으나 별도 공식ID 미부여 |
| F17~F18 | R&D 증가분/당기분 | Pass | 섹션 6.1 |
| **F19** | **사회보험료 공제** | **Missing** | 외부자료에 정의되나 설계서 공식 표에 없음 |
| F30~F34 | 환급액/가산금/지방세/총액 | Pass | 섹션 6.1 |
| F40~F41 | 농특세/농특세 변동 | Pass | 섹션 6.1 |

#### 종합소득세 공식 (F-INC-01~11)

| 공식ID | 공식명 | 설계서 반영 | 위치 |
|--------|--------|:---------:|------|
| F-INC-01~F-INC-06 | 종합소득금액~개인 최저한세 | Pass | 섹션 6.2 |
| **F-INC-07** | **공제가능한도** | **Missing** | 산출세액 - 최저한세액. P5-01 의사코드(섹션 12.4)에 로직 존재하나 공식 표에 미등록 |
| **F-INC-08** | **경정청구 환급액** | **Missing** | 개인 환급액 공식이 별도로 정의되지 않음. F30이 법인 전용으로 기술 |
| **F-INC-09** | **환급가산금 (개인)** | **Missing** | F31/F32와 통합 가능하나 개인 고유 기산일(5.31/6.30) 반영 공식 없음 |
| **F-INC-10** | **총 실질 환급액 (개인)** | **Missing** | 개인 전용 총액 공식 없음 |
| **F-INC-11** | **소급공제 환급세액 (개인)** | **Missing** | P4-09 모듈 누락과 연동 |

#### 공통 공식

| 공식ID | 공식명 | 설계서 반영 | 비고 |
|--------|--------|:---------:|------|
| **F-COM-01** | **이자상당가산액** | **Missing** | 사후관리 추징액 산출 공식. M7-03이 Phase 2이므로 연동하여 누락 |

---

## 8. 검증 규칙 완전성

### 결과: 75/95+ 규칙 반영 (79%) -- Warning

#### 공통 검증 규칙 (설계서 71건 vs 외부자료 84건+)

| 유형 | 설계서 건수 | 외부자료 건수 | 설계서 대비 | 누락 규칙 |
|------|:----------:|:-----------:|:----------:|----------|
| V (Validation) | 19 | 26 (V01~V26) | 73% | V20~V26 상세 미기술 (V-RD-01~03, V-LOSS-01, V-EMP-01 등) |
| C (Calculation) | 13 | 13 (C01~C13) | 100% | - |
| B (Business) | 11 | 13 (B01~B13) | 85% | B12, B13 누락 |
| L (Legal) | 9 | 9 (L01~L09) | 100% | - |
| X (Cross) | 13 | 21 (X01~X21) | 62% | X14~X21 대부분 누락 (JSON 보고서 교차검증) |
| W (Warning) | 6 | 5 (W01~W05) | 100%+ | 설계서가 1건 많음 |

#### 개인 전용 검증 규칙

| 유형 | 설계서 건수 | 외부자료 건수 | 누락 |
|------|:----------:|:-----------:|------|
| VP (Validation) | 3 | 6 (VP01~VP06) | VP04, VP05, VP06 누락 |
| CP (Calculation) | 3 | 5 (CP01~CP05) | CP04, CP05 누락 |
| BP (Business) | 3 | 5 (BP01~BP05) | BP04, BP05 누락 |
| LP (Legal) | 2 | 5 (LP01~LP05) | LP03, LP04, LP05 누락 |
| WP (Warning) | 1 | 2 (WP01~WP02) | WP02 누락 |
| XP (Cross) | 0 | 5 (XP01~XP05) | **전체 누락** |

#### 누락 검증 규칙 상세 (Critical/Major)

| 규칙ID | 유형 | 설명 | 심각도 |
|--------|------|------|:------:|
| V-RD-01~03 | Validation | R&D 중복/5개년/method 유효성 검증 | Major |
| V-LOSS-01 | Validation | 결손금 합계 일치 검증 | Major |
| V-EMP-01 | Validation | 고용 월별->연평균 재현 검증 | Major |
| X14~X17 | Cross | JSON 보고서 스키마/금액/항목 교차검증 | Major |
| XP01~XP05 | Cross (INC) | 개인 전용 교차검증 5건 전체 누락 | Major |
| LP04 | Legal (INC) | 2025년 SS6+SS29의8 중복 Hard Fail | Critical |
| VP06 | Validation (INC) | 성실사업자 자격 교차검증 | Major |
| CP04 | Calculation (INC) | 환급액 <= 실제납부세액 상한 검증 | Major |

---

## 9. 내부 일관성 (섹션 간 상호참조)

### 결과: 11/13 항목 Pass -- Warning

| 검증 항목 | 결과 | 상세 |
|----------|:----:|------|
| 모듈 번호 일치 (섹션 3 vs 섹션 2.2) | Pass | M1~MX 번호 체계 일치 |
| API 번호 일치 (섹션 4 vs 섹션 5) | Pass | API-01~08 일관 |
| 상태 전이 (섹션 5.2 vs 섹션 9.1) | Pass | 10개 상태, TX-1/TX-2 경계 일치 |
| 공식 ID (섹션 6 vs 섹션 12) | Pass | F01~F34, F-INC 의사코드 일치 |
| 테이블 수 (섹션 1.4 vs 섹션 5.3) | Pass | 83개 일치 |
| 트랜잭션 경계 (섹션 5 vs 섹션 9) | Pass | TX-1(M1), TX-2(M3-PREP~M6) 일치 |
| 보고서 섹션 수 (섹션 8 vs 섹션 4) | Pass | 7섹션 A~G 일치 |
| 절사 정책 (섹션 6.3 vs 섹션 1.2) | Pass | 4가지 규칙 일치 |
| 구현 순서 (섹션 11 vs 모듈 의존성) | Pass | M1->M3->M4->M5->M6 의존 그래프 일치 |
| Phase 1/2 구분 (섹션 11 vs FR 우선순위) | Pass | Must/Should 구분 일치 |
| **M6-05 vs M6-06 번호 혼용** | **Fail** | 섹션 3.1에서 M6-05가 "JSON 직렬화"와 "지방소득세 안내" 두 곳에 중복 사용. M6-06도 별도 존재. 외부자료에서는 M6-03(지방소득세), M6-05(JSON 직렬화)로 구분 |
| **검증 규칙 건수 불일치** | **Fail** | 섹션 2.1 "71개", 섹션 7.1 제목 "83개", 섹션 7.1 실제 나열은 공통 71 + 개인 12 = 83. 하지만 외부자료 v4.0은 공통 규칙이 84건 이상으로 확장되었으므로 버전 기준 명시 필요 |

---

## 10. 트랜잭션 설계

### 결과: Pass (Minor Warning 2건)

| 검증 항목 | 결과 | 상세 |
|----------|:----:|------|
| TX-1 경계 (M1-01~M1-03) | Pass | 섹션 9.1: READ COMMITTED, 60초 타임아웃 |
| TX-2 경계 (M3-PREP~M6-05) | Pass | 섹션 9.1: READ COMMITTED, 300초 타임아웃 |
| TX 분리 원칙 | Pass | API-01(TX-1) / API-02(TX-2) 별도 HTTP 요청 |
| All-or-Nothing | Pass | TX-2 내 부분 성공 불허 명시 |
| 재처리 지원 | Pass | 기존 데이터 DELETE 후 재생성 명시 |
| req_id 동시성 (SELECT FOR UPDATE) | Pass | 섹션 9.2 상세 |
| **TX-1 격리수준** | **Warning** | M1-01에서 SERIALIZABLE 사용(섹션 3.2)하지만 TX-1 전체는 READ COMMITTED(섹션 9.1). req_id 발급만 SERIALIZABLE이라면 Savepoint 또는 별도 TX 필요. 명확화 권고 |
| **상태 기록 메커니즘** | **Warning** | "상태 기록은 TX 외부"로 명시(섹션 9.1)하나 구체적 구현 방법(별도 커넥션? Spring @Transactional(REQUIRES_NEW)?)이 없음 |

---

## 심각도별 이슈 종합

### Critical (3건) -- 구현 전 반드시 해결

| No | 항목 | 상세 | 권고 |
|----|------|------|------|
| C-01 | req_id 신청인구분 코드 불일치 | 외부자료: C/P, 설계서/glossary: C/I. 구현 시 혼란 야기 | 최종 코드 확정 후 전 문서 통일 |
| C-02 | P4-09~P4-14 (6개 개인 공제 모듈) 설계 누락 | F-INC-11 공식은 정의되었으나 구현 모듈 없음. 특히 P4-09 결손금 소급공제는 FR-31(Should) 요구사항 | Phase 1/Phase 2 명확 분류 후 최소 P4-09 상세 설계 추가 |
| C-03 | LP04 검증 규칙 누락 | 2025년 이후 SS6+SS29의8 중복 Hard Fail 규칙이 설계서 검증 엔진에 명시적으로 없음. B01 규칙에 포함 가능하나 연도별 분기 로직 상세 부재 | M5-01 상호배제 + MX-03 검증 엔진에 LP04 규칙 명시 추가 |

### Major (9건) -- 구현 품질에 영향

| No | 항목 | 상세 |
|----|------|------|
| M-01 | FR-25 (M4-03 사보공제) 상세 설계 누락 | 모듈 계층에는 있으나 설계 표에 없음 |
| M-02 | FR-29 (M4-08 이월결손금 재검토) 모듈 누락 | Phase 1/2 분류도 없음 |
| M-03 | M4-12~M4-14 (3개 CORP 모듈) Phase 분류 누락 | 외부자료에 존재하나 설계서에 미언급 |
| M-04 | F-INC-07~F-INC-11 (5개 개인 공식) 누락 | 개인 환급액/가산금/소급공제 공식 부재 |
| M-05 | F-COM-01 (이자상당가산액) 공식 누락 | 사후관리 추징액 핵심 공식 |
| M-06 | X14~X21 (8개 교차검증) 규칙 누락 | JSON 보고서 무결성 검증 부재 |
| M-07 | XP01~XP05 (5개 개인 교차검증) 전체 누락 | 개인 소득/공제 교차검증 부재 |
| M-08 | VP04~VP06, CP04~CP05, BP04~BP05 (7개) 누락 | 개인 전용 검증 규칙 커버리지 부족 |
| M-09 | M6-03/M6-05/M6-06 번호 혼용 | 지방소득세 안내 vs JSON 직렬화 번호 충돌 |

### Minor (4건) -- 개선 권장

| No | 항목 | 상세 |
|----|------|------|
| m-01 | FR-51, FR-52 생성 로직 상세 부재 | CO_S_ADDITIONAL_CHECK, CO_S_RISK 생성 기준 미정의 |
| m-02 | M2-10~M2-13 기준정보 관리 설계 없음 | RF_I_* 테이블 CRUD/갱신 프로세스 부재 |
| m-03 | Plan 문서 API 엔드포인트 갱신 필요 | PUT /calculate -> POST /analyze 변경 미반영 |
| m-04 | Idempotency-Key 구현 상세 부재 | TTL, 캐시 저장소, 중복 응답 반환 로직 미정의 |

---

## 개선 권고사항

### 1. 즉시 조치 (Critical)

1. **req_id 신청인구분 코드 통일**: `C`=법인, `I`=개인으로 확정하고 외부자료의 `P` 표기를 `I`로 정정. 또는 외부자료 기준 `C`/`P`로 통일. 전 문서(설계서, glossary, ERD, 외부자료) 일괄 수정.

2. **개인 전용 모듈 Phase 분류 확정**: P4-09~P4-14, M4-08, M4-12~M4-14를 Phase 1(MVP) 또는 Phase 2(고도화)로 명확히 분류. 최소 P4-09(결손금 소급공제)는 FR-31이 Should이므로 Phase 2에 포함시키되 인터페이스(CreditCalculator) 수준의 스텁 설계 추가.

3. **LP04 검증 규칙 추가**: M5-01 상호배제 검증에 2025년 이후 SS6+SS29의8 중복 Hard Fail 규칙을 명시적으로 추가.

### 2. 단기 조치 (Major, 1주 내)

4. **F-INC-07~F-INC-11 공식 추가**: 섹션 6.2에 개인 환급액 관련 5개 공식 추가. 특히 F-INC-08(경정청구 환급액)은 F30과 유사하나 개인 고유 기산일(5.31/6.30) 반영 필요.

5. **교차검증 규칙 보강**: X14~X21(JSON 보고서 교차검증), XP01~XP05(개인 교차검증) 총 13건을 섹션 7에 추가.

6. **M4-03 사보공제 상세 설계**: 섹션 3.5 서브모듈 설계표에 M4-03 행 추가 (입력: SV_S_EMPLOYEE, 출력: CO_S_CREDIT_DETAIL, 핵심 로직: 사업주부담분 x 공제율).

7. **M6 모듈 번호 정리**: M6-03(지방소득세), M6-04(보고서 3종), M6-05(JSON 직렬화)로 통일. 설계서의 M6-06 표기를 M6-03으로 변경.

### 3. 중기 조치 (Minor, Phase 2 전)

8. FR-51/FR-52 생성 로직 설계
9. M2-10~M2-13 기준정보 관리 프로세스 설계
10. Plan 문서 API 엔드포인트 정보 갱신
11. Idempotency-Key 구현 상세 추가

---

## 부록: 검증 항목별 체크리스트

```
[Pass] 1. 시스템 개요 (목적, 설계 원칙, req_id 규칙)
[Pass] 2. 아키텍처 설계 (기술 스택, Clean Architecture, 3계층 데이터)
[Warn] 3. 모듈 상세 설계 (M4-08/12/13/14, P4-09~14, P1-*, M2-10~13 누락)
[Pass] 4. REST API 설계 (8개 엔드포인트 완전 매핑)
[Pass] 5. 데이터 처리 파이프라인 (전체 흐름, 상태 전이, 모듈별 I/O)
[Warn] 6. 계산 엔진 설계 (F-INC-07~11, F-COM-01, F16, F19 누락)
[Warn] 7. 검증 엔진 설계 (X14~X21, XP01~05, VP04~06 등 20건+ 누락)
[Pass] 8. 보고서 생성 설계 (7섹션, 3종 보고서)
[Pass] 9. 트랜잭션 및 동시성 설계 (TX-1/TX-2, 동시성 제어)
[Pass] 10. 보안 및 데이터 보호 (API Key, AES-256, JWT, TLS)
[Pass] 11. 구현 순서 및 의존성 (Phase 1/2, 모듈 의존성 그래프)
[Pass] 12. 부록: 핵심 의사코드 (M5-02, M6-02, P4-02, P5-01)
```

---

## 버전 이력

| 버전 | 일자 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| v1.0 | 2026-02-17 | 초안 - 10개 검증 항목 전체 수행 | Design Validator Agent |
