# 통합 경정청구 환급액 산출 시스템 — 변경이력 (v1.0 → v4.0)

> **원본 문서**: 통합개발상세설계서_v4_0.md
> **분리일**: 2026-02-17
> **목적**: 설계 본문과 이력/검토 정보를 분리하여 가독성 향상

---

## 1. v4.0 프롬프트 대비 커버리지 보완 확인

| 프롬프트 점검 | v3.0 상태 | v4.0 보완 | 상태 |
|--------------|----------|----------|------|
| 점검 0 (세무조정) | M4-11 존재 | 국고보조금·가지급금·업무무관자산·업무용 승용차·접대비 상세화 | ✅ |
| 점검 0 (소급공제) | M4-10 존재 | NPV 할인율 파라미터화 (RF_S_SYSTEM_PARAM) | ✅ |
| 점검 0 (결산확정) | M3-06 존재 | 변경 없음 | ✅ |
| 점검 12 (업종 제한) | 언급만 | RF_S_INDUSTRY_ELIGIBILITY 신설 | ✅ |
| 점검 16 (청년등 정의) | RI_S_EMPLOYEE_DETAIL | RI_S_EMPLOYEE_MONTHLY에 nk_defector_count 추가 | ✅ |
| 점검 27 (이월결손금) | RI_S_LOSS_CARRYFORWARD | 변경 없음 | ✅ |
| 점검 28 (수입배당금) | M4-09, RF_C_DIVIDEND_EXCLUSION | 익금불산입률 3단계 정정 (E09) | ✅ |
| 점검 29 (중간예납) | RI_C_INTERIM_TAX, M6-02 | 변경 없음 | ✅ |
| 점검 9-2 (중소기업 판단) | M7-01 | 연도별 중소기업 재판단 로직 추가 (M36) | ✅ |
| 점검 9-4 (기존 신고) | RI_S_EXISTING_DEDUCTION | RI_C_TAX_ADJUSTMENT 추가 (E15) | ✅ |
| 점검 9-5 (환급가산금) | RF_S_REFUND_INTEREST_RATE | 갱신 프로세스 명시 (M34) | ✅ |

---

## 2. v4.0r1 외부검토 반영 커버리지 확인

| 프롬프트 점검 | v4.0 상태 | v4.0r1 보완 | 상태 |
|--------------|----------|------------|------|
| 점검 9-3 (적용순서·법인고유) | 순서 존재 | 재해손실세액공제(§58) M4-15·F56 신설 | ✅ |
| 점검 10 (투자 제외 대상) | 일반 제외만 | 임대자산·중고품 배제 필드 + 무형자산 구분 추가 | ✅ |
| 점검 14 (청년 판단 시점) | M3-04에서 연도별 분기 | v4.0에서 이미 반영 완료 (2차 지적은 기반영 확인) | ✅ |
| 점검 20-2 (벤처 3년) | RI_S_STARTUP_INFO | 벤처확인일-창업일 ≤ 3년 검증 로직 + V19 규칙 | ✅ |
| 점검 26 (외국납부·간접공제) | 직접공제만 | 간접외국납부세액공제 로직 + RI_S_FOREIGN_TAX 확장 | ✅ |
| 점검 32 (연결납세) | M4-14 모듈 | RI_C_CONSOLIDATED_SUB 데이터 구조 신설 | ✅ |
| 경정청구 불가 사유 | 언급 없음 | M43 사전 검증 모듈 + STEP 0 보강 | ✅ |
| 결산확정 원칙 (유보 추인) | M3-06 존재 | RI_C_DEPRECIATION_ADJUST + M42 추인 검토 로직 | ✅ |
| 점검 15-6 [E] (사후관리) | I21 리스크 정량화 | 퇴사 예외사유(resign_exception_code) 추가 | ✅ |

---

## 3. v1.1 지적사항 검토 결과

### A.1 1차 지적사항 검토 (5건)

| No | 지적 내용 | 정당성 | 판단 근거 | 반영 위치 |
|----|----------|--------|----------|----------|
| 1-1 | [개인] 건강보험료 필요경비 vs 소득공제 분기 로직 미흡 | ✅ 정당 | 프롬프트 ㉖규칙에 3분류(지역→소득공제, 직장본인→소득공제, 근로자사업주부담→필요경비) 명시. v1.0에서는 가입유형 2분류만 처리 | P4-01b |
| 1-2 | [법인] 업무용 승용차 세무조정 재검토 모듈 미구체화 | ✅ 정당 | 프롬프트 점검0에 운행기록부/전용보험/감가상각한도 상세 로직 있으나 v1.0에 미반영 | M4-11a 신설 |
| 1-3 | [개인] 성실신고확인대상 판단이 수동입력 의존 | ✅ 정당 | RF_I_SINCERITY_THRESHOLD 테이블이 있으므로 자동 판정 가능. 수동입력은 오류 위험 | P3-02 |
| 1-4 | [법인] 결산확정 원칙 검증 필터 부족 | ✅ 정당 | v1.0에 결산조정 차단 언급 있으나 구체적 필터링 항목·처리 방식 미명시 | M3-00, LP05 |
| 1-5 | [공통] 사후관리 추징액에 이자상당가산액 미포함 | ✅ 정당 | 프롬프트에 인당 추징 예상액 수치화 지시 있고, 이자상당가산액은 실무 필수 | M7-03, F-COM-01 |

### A.2 1차 신규 검증 규칙 제안 (3건)

| 코드 | 정당성 | 판단 근거 | 반영 |
|------|--------|----------|------|
| VP06 | ✅ 정당 | 성실대상 아닌 자가 §122의3 신청 시 국세청 거부 → 사전 차단 필요 | 반영 |
| BP05 | ✅ 정당 | 이월결손금 한도(중소100%/일반80%)는 법인세법 §13 핵심 규정이나 v1.0에 미명시 | 반영 |
| LP04 | ✅ 정당 | 2024 세법개정으로 2025.1.1 이후 창업분 §6+§29의8 중복배제 강제 — 실무 리스크 높음 | 반영 |

### A.3 2차 지적사항 검토

> 2차는 1차 지적사항에 대한 구체적 보완안(v1.1)을 제시한 것으로, 추가 지적 1건 식별:

| No | 지적 내용 | 정당성 | 판단 근거 | 반영 위치 |
|----|----------|--------|----------|----------|
| 2-1 | LP05 검증 규칙 추가 (결산조정 항목 필터링) | ✅ 정당 | 1차의 M3-00 강화와 연계, 검증 규칙으로 명시적 코드 부여 필요 | LP05 |

### A.4 3차 지적사항 검토

> 3차는 실무 관점에서 정밀도와 보고서 품질 개선을 제안:

| No | 지적 내용 | 정당성 | 판단 근거 | 반영 위치 |
|----|----------|--------|----------|----------|
| 3-1 | 수입배당금 익금불산입 연도별 적용기준 매칭 | ✅ 정당 | 2023년 개정규정(3단계)/종전규정(4~5단계) 구분이 경정청구 실무에서 핵심 — v1.0 미구체화 | M4-09 |
| 3-2 | 최종 환급 보고서 4부 구조화 | ✅ 정당 | 환급요약+최저한세분석+지방소득세+사후관리로 구조화하면 납세자 가독성 향상 | M6-04 |
| 3-3 | 세율구간 시뮬레이션 시 노란우산공제 명시 | ✅ 정당 | P4-01에 이미 포함되어 있으나 시뮬레이션 시나리오 비교에서 명시적 언급 부족 | P4-01d |

### A.5 검토 총평

| 항목 | 수치 |
|------|------|
| 총 지적사항 | 1차 8건 + 2차 1건 + 3차 3건 = **12건** |
| 정당한 지적 | **12건 (100%)** |
| 반영 완료 | **12건 (100%)** |
| 반영 결과 | 모듈 1건 신설(M4-11a), 검증규칙 4건 추가(VP06/BP05/LP04/LP05), 계산공식 1건 추가(F-COM-01), 로직 보완 6건 |

---

## 4. v3.1 최적화 변경이력

### 변경 이력 (v3.0 → v3.1)

| No | 분류 | 변경 내용 | 영향 범위 | 위치 |
|----|------|----------|----------|------|
| O-01 | 오류수정 | CO_S_REPORT_JSON 컬럼번호 14번 중복 → 14(checksum), 15(generated_at) 정정 | §26 | line ~1997 |
| O-02 | 오류수정 | 문서 내부 참조 "§3.1 No.39~41" → "부록 §38 → 3.1 RI_C_CORP_BASIC No.39~41" 정정 | §6B 변경이력 T01, T02 | line ~614 |
| O-03 | 오류수정 | REF 테이블 참조 "§4.1~4.22" → "본 문서 §14~§18에 정의" 정정 | §13 REF 테이블 서두 | line ~1204 |
| I-01 | 신설 | API 표준 오류 응답 스키마 (§28.5) — 10개 오류 코드 정의 | §28 REST API | line ~2308 |
| I-02 | 보강 | M1-01 동시성 제어 — `SELECT FOR UPDATE` + 데드락 재시도 로직 | §30.1 M1-01 | line ~2399 |
| I-03 | 보강 | M1-02 사전 검증 — JSON 크기·카테고리 수·필수 카테고리 검증 추가 | §30.2 M1-02 | line ~2420 |
| I-04 | 보강 | M1-03 재처리 시 버전 관리 — 기존 SV_* 삭제 후 재생성, prev_data_hash 기록 | §30.3 M1-03 | line ~2445 |
| I-05 | 신설 | 트랜잭션 경계 정의 (§33.0) — TX-1, TX-2 범위·격리수준·타임아웃 명시 | §33 업무처리 절차서 | line ~3710 |
| I-06 | 신설 | 성능 제한 사양 (§29.1) — JSON 크기·타임아웃·페이징 등 10개 항목 정의 | §29 데이터 흐름 | line ~2382 |
| I-07 | 보강 | RI_S_REQUEST 감사추적 컬럼 추가 — modified_by, modified_at, version | §7 RI_S_REQUEST | line ~845 |
| I-08 | 보강 | AL_S_CALCULATION 감사추적 강화 — log_level, executed_by, duration_ms, trace_id, prev_data_hash + 인덱스 4개 | §25 AL_S_CALCULATION | line ~1970 |
| I-09 | 신설 | 검증 규칙 실행 순서 및 의존성 (§35.0) — 6단계 Phase 정의, 의존성 그래프 | §35 검증 규칙 | line ~5085 |
| I-10 | 신설 | 핵심 공식 검증 테스트 케이스 (§34.4) — 4개 공식군 22개 TC | §34 계산 공식 | line ~5078 |

> **v3.1 변경 통계**: 오류수정 3건 + 보강 4건 + 신설 5건 = 총 12건

---

## 5. 부록 A: v1.1 오류지적사항 검토 결과

> 아래는 v1.0에 대해 제출된 오류지적사항 4건에 대한 검토 결과입니다. v1.1에서 반영되었으며, v3.0에 모두 통합되었습니다.

### ① 소재지 판단 기준의 혼선 — 판정: **부분 타당 (반영)**

**지적 내용**: M3-03에서 본점 간주 규정을 일괄 적용하여 제24조(투자공제)에서 비수도권 자산의 공제 기회를 놓칠 위험이 있다.

**반영 내용**: M3-03 기능 설명 변경, 소재지 이원화 로직 분기 함수 추가 (7.7절), 검증 규칙 V09 추가 → **v3.0 §7.7 반영 완료**

### ② 수입배당금 익금불산입 기준표 누락 — 판정: **타당 (반영)**

**지적 내용**: M4-09 기능은 목록에 존재하나, 기준정보 테이블과 연도별 처리 로직이 누락되어 있다.

**반영 내용**: RI_C_DIVIDEND_INCOME (§3.14), RF_C_DIVIDEND_EXCLUSION (§4.15), M4-09 상세 로직 (§7.9) → **v3.0 반영 완료**

### ③ 최저한세 배제 항목의 세분화 부족 — 판정: **부분 타당 (반영)**

**지적 내용**: M5-03에서 R&D 최저한세 배제분을 뭉뚱그려 처리하고 있어 유형별 가중치 적용 로직이 필요하다.

**반영 내용**: RF_C_RD_MIN_TAX_EXEMPT (§4.16), calculate_rd_min_tax_exempt() 함수 (§7.8) → **v3.0 반영 완료**

### ④ 결손금 소급공제(Loss Carryback) 로직 부재 — 판정: **타당 (반영)**

**지적 내용**: M4-08에 이월결손금 재검토 기능은 있으나, 중소기업의 소급공제 vs 이월공제 실익 비교 엔진이 없다.

**반영 내용**: M4-10 모듈 (§7.10), RI_C_CORP_BASIC 입력 필드 추가, 계산 공식 §8.5.9 → **v3.0 반영 완료**

---

## 6. 부록 B: v4.0 개발 우선순위

### 우선순위 1 — 필수 오류 수정 (즉시)

| No | 항목 | 영향도 |
|----|------|--------|
| E08 | 농특세 비과세 항목 정정 (F40) | 환급액 산출 오류 직결 |
| E09 | 수입배당금 익금불산입률 3단계 정정 | 과세표준 재계산 오류 |
| E11 | RI_S_EMPLOYEE_MONTHLY 북한이탈주민 컬럼 | 고용세액공제 산출 누락 |

### 우선순위 2 — 핵심 누락 보완 (1주 이내)

| No | 항목 | 영향도 |
|----|------|--------|
| E12~E15 | 세무조정 관련 입력 테이블 4개 신설 | 세무조정 재검토 기능 완성 |
| M25~M28 | 접대비·업종별 감면·가지급금·업무무관자산 | 추가 환급 발굴 |
| M31 | 환급 결정 예상일 | 환급가산금 정확도 |

### 우선순위 3 — 외부 참조 데이터 (2주 이내)

| No | 항목 | 영향도 |
|----|------|--------|
| M26 | RF_S_INDUSTRY_ELIGIBILITY (감면 적격성) | 업종 판단 자동화 |
| M25 | RF_C_ENTERTAINMENT_LIMIT (접대비 한도) | 손금불산입 정확도 |
| M32 | RF_S_SYSTEM_PARAM (NPV 할인율) | 시스템 유연성 |
| M35 | RF_S_KSIC_CODE (산업분류) | 입력 검증 |

### 우선순위 4 — 개선사항 (1개월 이내)

| No | 항목 | 영향도 |
|----|------|--------|
| I16 | 순환 참조 해결 (최저한세 재계산 루프) | 계산 정확도 |
| I17 | 다수 과세연도 중소기업 재판단 | 복수 연도 정확도 |
| I20 | 농특세 연쇄 영향 자동화 | 실질 환급 정확도 |
| I21 | 사후관리 리스크 정량화 | 의사결정 지원 |

### 우선순위 5 — 외부검토 반영 (v4.0r1)

| No | 항목 | 영향도 | 일정 |
|----|------|--------|------|
| E16 | 임대/중고 자산 배제 필드 (RI_C_INVESTMENT_ASSET) | 과대 공제 방지 | 즉시 |
| E18 | 간접외국납부세액공제 (RI_S_FOREIGN_TAX + M4-07) | 해외 소득 법인 필수 | 1주 |
| M37 | 재해손실세액공제 (RI_C_DISASTER_LOSS + M4-15) | 재해 법인 한정 | 1주 |
| M38 | 연결납세 자회사 (RI_C_CONSOLIDATED_SUB) | 연결납세 법인 한정 | 2주 |
| M43 | 경정청구 불가 사유 검증 (STEP 0) | 사전 필터 필수 | 즉시 |
| M42 | 감가상각 시부인 이월 추인 | 경정청구 추가 환급 | 2주 |
